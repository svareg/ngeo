{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./contribs/gmf/examples/mobilemeasure.js","webpack:///./contribs/gmf/src/mobile/measure/areaComponent.js","webpack:///./contribs/gmf/src/mobile/measure/baseComponent.html","webpack:///./contribs/gmf/src/mobile/measure/baseComponent.js","webpack:///./contribs/gmf/src/mobile/measure/lengthComponent.js","webpack:///./contribs/gmf/src/mobile/measure/pointComponent.html","webpack:///./contribs/gmf/src/mobile/measure/pointComponent.js","webpack:///./src/interaction/MeasureAreaMobile.js","webpack:///./src/interaction/MeasureLengthMobile.js","webpack:///./src/interaction/MeasurePointMobile.js","webpack:///./src/interaction/MobileDraw.js"],"names":["module","angular","gmfMapComponent","name","gmfPermalinkPermalink","gmfMobileMeasureAreaComponent","gmfMobileMeasureLengthComponent","gmfMobileMeasurePointComponent","ngeoMiscBtnComponent","value","appURL","RASTER","constant","MainController","gmfPermalink","center","getMapCenter","zoom","getMapZoom","map","olMap","layers","olLayerTile","source","olSourceOSM","view","olView","projection","EPSG21781","resolutions","addControl","olControlScaleLine","measureAreaActive","measureLengthActive","measurePointLayersConfig","unit","decimals","measurePointActive","controller","ngeoMiscFilters","element","attrs","templateUrl","undefined","run","$templateCache","put","require","mobileMeasureAreaComponent","gmfMobileMeasureAreaTemplateUrl","restrict","scope","bindToController","link","init","directive","Controller","$scope","$filter","gettextCatalog","measure","ngeoInteractionMeasureAreaMobile","filter","precision","sketchStyle","addPoint","drawInteraction","addToDrawing","clear","clearDrawing","finish","finishDrawing","deactivate","active","MeasueMobileBaseController","$watch","newVal","setActive","olStyleStyle","fill","olStyleFill","color","stroke","olStyleStroke","lineDash","width","image","olStyleRegularShape","points","radius","radius2","angle","dirty","drawing","valid","prototype","interactionDecoration","getDrawInteraction","Object","defineProperty","get","getFeature","olEvents","evt","getDirty","$apply","getDrawing","getValid","addInteraction","mobileMeasureLenthComponent","gmfMobileMeasureLengthTemplateUrl","ngeoInteractionMeasureLengthMobile","gmfRasterRasterService","ngeoMiscDebounce","mobileMeasurePointComponent","gmfMobileMeasurePointTemplateUrl","MobileMeasurePointController","gmfRaster","ngeoDebounce","gmfRaster_","ngeoDebounce_","gettextCatalog_","$filter_","handleMeasureActiveChange_","coordinateDecimalsFn","coordinateDecimals","layersConfig","format","mapViewPropertyChangeEventKey_","ngeoInteractionMeasurePointMobile","console","assert","Array","isArray","translate","str","getString","getActive","getView","getMeasure_","bind","getCenter","params","config","join","getRaster","then","object","el","getTooltipElement","ctn","document","createElement","className","key","childEl","innerHTML","appendChild","previousCtn","getElementsByClassName","remove","MeasureAreaMobile","options","assign","displayHelpTooltip","createDrawInteraction","style","ngeoInteractionMobileDraw","type","ngeoInteractionMeasureArea","opt_options","ngeoInteractionMeasureLength","coordFormat","format_","coordFormat_","handleMeasure","callback","geom","sketchFeature","getGeometry","dec","output","getFormattedPoint","coord","getLastCoordinate","ngeoInteractionMeasure","handleEvent","TRUE","changeEventKey_","type_","minPoints_","minPoints","sketchFeature_","sketchPoints_","sketchPoint_","overlay_","olLayerVector","olSourceVector","useSpatialIndex","wrapX","getDefaultDrawStyleFunction","updateWhileAnimating","updateWhileInteracting","updateState_","set","setMap","currentMap","getMap","olInteractionInteraction","call","handleViewCenterChange_","sketchFeatureGeom","sketchPointGeom","getSketchPointGeometry_","coordinate","getCoordinates","coordinates","olFeature","olGeomPoint","event","ngeoCustomEvent","feature","dispatchEvent","olGeomSimpleGeometry","setCoordinates","push","slice","olGeomLineString","olGeomPolygon","coordinatess","length","updateSketchFeatures_","startDrawing_","createOrUpdateSketchPoint_","modifyDrawing_","getCenter_","pop","abortDrawing_","getSource","geometry","sketchFeatures","overlaySource","addFeatures"],"mappings":";AAAA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,gBAAQ,oBAAoB;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,yBAAiB,4BAA4B;AAC7C;AACA;AACA,0BAAkB,2BAA2B;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,kDAA0C,gCAAgC;AAC1E;AACA;;AAEA;AACA;AACA;AACA,gEAAwD,kBAAkB;AAC1E;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAyC,iCAAiC;AAC1E,wHAAgH,mBAAmB,EAAE;AACrI;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;AACA;AACA;AACA,wBAAgB,uBAAuB;AACvC;;;AAGA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtJA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAOA,IAAMA,MAAM,GAAGC,8CAAO,CAACD,MAAR,CAAe,QAAf,EAAyB,CACtC,SADsC,EAEtCE,4DAAe,CAACC,IAFsB,EAGtCC,kEAAqB,CAACD,IAHgB,EAItCE,2EAA6B,CAACF,IAJQ,EAKtCG,6EAA+B,CAACH,IALM,EAMtCI,4EAA8B,CAACJ,IANO,EAOtCK,iEAAoB,CAACL,IAPiB,CAAzB,CAAf;AAWAH,M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","file":"mobilemeasure.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"mobilemeasure\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([16,\"commons\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import angular from 'angular';\nimport appURL from './url.js';\nimport './mobilemeasure.css';\nimport gmfMapComponent from 'gmf/map/component.js';\n\nimport gmfPermalinkPermalink from 'gmf/permalink/Permalink.js';\n\nimport gmfMobileMeasureAreaComponent from 'gmf/mobile/measure/areaComponent.js';\nimport gmfMobileMeasureLengthComponent from 'gmf/mobile/measure/lengthComponent.js';\nimport gmfMobileMeasurePointComponent from 'gmf/mobile/measure/pointComponent.js';\nimport ngeoMiscBtnComponent from 'ngeo/misc/btnComponent.js';\nimport EPSG21781 from '@geoblocks/proj/src/EPSG_21781.js';\nimport olMap from 'ol/Map.js';\nimport olView from 'ol/View.js';\nimport olControlScaleLine from 'ol/control/ScaleLine.js';\nimport olLayerTile from 'ol/layer/Tile.js';\nimport olSourceOSM from 'ol/source/OSM.js';\n\n\n/**\n * @type {!angular.IModule}\n * @hidden\n */\nconst module = angular.module('gmfapp', [\n  'gettext',\n  gmfMapComponent.name,\n  gmfPermalinkPermalink.name,\n  gmfMobileMeasureAreaComponent.name,\n  gmfMobileMeasureLengthComponent.name,\n  gmfMobileMeasurePointComponent.name,\n  ngeoMiscBtnComponent.name,\n]);\n\n\nmodule.value('gmfRasterUrl', appURL.RASTER);\n\nmodule.constant('defaultTheme', 'Demo');\nmodule.constant('angularLocaleScript', '../build/angular-locale_{{locale}}.js');\n\n\n/**\n * @param {import(\"gmf/permalink/Permalink.js\").PermalinkService} gmfPermalink The gmf permalink service.\n * @constructor\n * @ngInject\n */\nfunction MainController(gmfPermalink) {\n\n  const center = gmfPermalink.getMapCenter() || [537635, 152640];\n  const zoom = gmfPermalink.getMapZoom() || 3;\n\n  /**\n   * @type {import(\"ol/Map.js\").default}\n   */\n  this.map = new olMap({\n    layers: [\n      new olLayerTile({\n        source: new olSourceOSM()\n      })\n    ],\n    view: new olView({\n      projection: EPSG21781,\n      resolutions: [200, 100, 50, 20, 10, 5, 2.5, 2, 1, 0.5],\n      center: center,\n      zoom: zoom\n    })\n  });\n\n  this.map.addControl(new olControlScaleLine());\n\n  /**\n   * @type {boolean}\n   */\n  this.measureAreaActive = false;\n\n  /**\n   * @type {boolean}\n   */\n  this.measureLengthActive = false;\n\n  /**\n   * @type {Array<import('gmf/mobile/measure/pointComponent.js').LayerConfig>}\n   */\n  this.measurePointLayersConfig = [\n    {name: 'aster', unit: 'm', decimals: 2},\n    {name: 'srtm', unit: 'm'}\n  ];\n\n  /**\n   * @type {boolean}\n   */\n  this.measurePointActive = false;\n\n}\n\n\nmodule.controller('MainController', MainController);\n\n\nexport default module;\n","import angular from 'angular';\nimport ngeoMiscFilters from 'ngeo/misc/filters.js';\nimport ngeoInteractionMeasureAreaMobile from 'ngeo/interaction/MeasureAreaMobile.js';\nimport {MeasueMobileBaseController} from 'gmf/mobile/measure/baseComponent.js';\n\n\n/**\n * @type {!angular.IModule}\n * @hidden\n */\nconst module = angular.module('gmfMobileMeasureArea', [\n  ngeoMiscFilters.name,\n]);\n\n\nmodule.value('gmfMobileMeasureAreaTemplateUrl',\n  /**\n   * @param {JQuery} element Element.\n   * @param {angular.IAttributes} attrs Attributes.\n   * @return {string} The template url.\n   */\n  (element, attrs) => {\n    const templateUrl = attrs['gmfMobileMeasureAreaTemplateurl'];\n    return templateUrl !== undefined ? templateUrl :\n      'gmf/measure/areaComponent';\n  });\n\nmodule.run(/* @ngInject */ ($templateCache) => {\n  // @ts-ignore: webpack\n  $templateCache.put('gmf/measure/areaComponent', require('./baseComponent.html'));\n});\n\n\n/**\n * Provide a directive to do a area measure on the mobile devices.\n *\n * Example:\n *\n *      <div gmf-mobile-measurearea\n *        gmf-mobile-measurearea-active=\"ctrl.measureAreaActive\"\n *        gmf-mobile-measurearea-map=\"::ctrl.map\">\n *      </div>\n *\n * @htmlAttribute {boolean} gmf-mobile-measurearea-active Used to active\n * or deactivate the component.\n * @htmlAttribute {number=} gmf-mobile-measurearea-precision the number of significant digits to display.\n * @htmlAttribute {import(\"ol/Map.js\").default} gmf-mobile-measurearea-map The map.\n * @htmlAttribute {import(\"ol/style/Style.js\").StyleLike=}\n *     gmf-mobile-measurearea-sketchstyle A style for the measure area.\n * @param {string|function(!JQuery=, !angular.IAttributes=):string}\n *     gmfMobileMeasureAreaTemplateUrl Template URL for the directive.\n * @return {angular.IDirective} The Directive Definition Object.\n * @ngInject\n * @ngdoc directive\n * @ngname gmfMobileMeasureArea\n */\nfunction mobileMeasureAreaComponent(gmfMobileMeasureAreaTemplateUrl) {\n  return {\n    restrict: 'A',\n    scope: {\n      'active': '=gmfMobileMeasureareaActive',\n      'precision': '<?gmfMobileMeasureareaPrecision',\n      'map': '=gmfMobileMeasureareaMap',\n      'sketchStyle': '=?gmfMobileMeasureareaSketchstyle'\n    },\n    controller: 'GmfMobileMeasureAreaController as ctrl',\n    bindToController: true,\n    templateUrl: gmfMobileMeasureAreaTemplateUrl,\n    /**\n     * @param {angular.IScope} scope Scope.\n     * @param {JQuery} element Element.\n     * @param {angular.IAttributes} attrs Attributes.\n     * @param {Controller} controller Controller.\n     */\n    link: (scope, element, attrs, controller) => {\n      controller.init();\n    }\n  };\n}\n\n\nmodule.directive('gmfMobileMeasurearea', mobileMeasureAreaComponent);\n\n\n/**\n * @private\n * @hidden\n */\nclass Controller extends MeasueMobileBaseController {\n  /**\n   * @param {!angular.IScope} $scope Angular scope.\n   * @param {!angular.IFilterService} $filter Angular filter\n   * @param {!angular.gettext.gettextCatalog} gettextCatalog Gettext catalog.\n   * @ngInject\n   */\n  constructor($scope, $filter, gettextCatalog) {\n    super($scope, $filter, gettextCatalog);\n\n    /**\n     * @type {import(\"ngeo/interaction/MeasureAreaMobile.js\").default}\n     */\n    this.measure;\n  }\n\n  /**\n   * Initialise the controller.\n   */\n  init() {\n    this.measure = new ngeoInteractionMeasureAreaMobile(this.filter('ngeoUnitPrefix'), this.gettextCatalog, {\n      precision: this.precision,\n      sketchStyle: this.sketchStyle\n    });\n\n    super.init();\n  }\n\n  /**\n   * Add current sketch point to line measure\n   */\n  addPoint() {\n    this.drawInteraction.addToDrawing();\n  }\n\n  /**\n   * Clear the sketch feature\n   */\n  clear() {\n    this.drawInteraction.clearDrawing();\n  }\n\n  /**\n   * Finish line measure\n   */\n  finish() {\n    this.drawInteraction.finishDrawing();\n  }\n\n  /**\n   * Deactivate the directive.\n   */\n  deactivate() {\n    this.active = false;\n  }\n}\n\nmodule.controller('GmfMobileMeasureAreaController', Controller);\n\nexport default module;\n","module.exports = function(obj) {\nobj || (obj = {});\nvar __t, __p = '';\nwith (obj) {\n__p += '<a class=\"btn btn-default\"\\n   ng-if=\"ctrl.drawing && (!ctrl.valid)\"\\n   ng-click=\"ctrl.addPoint()\">\\n     <span class=\"fa fa-check\"></span>\\n     {{\\'Set as starting point\\' | translate}}\\n</a>\\n<a class=\"btn btn-default\"\\n   ng-if=\"ctrl.dirty\"\\n   ng-click=\"ctrl.addPoint()\">\\n     <span class=\"fa fa-plus\"></span>\\n     {{\\'Add new point\\' | translate}}\\n</a>\\n<a class=\"btn btn-default\"\\n   ng-if=\"ctrl.drawing && ctrl.valid && !ctrl.dirty\"\\n   ng-click=\"ctrl.finish()\">\\n     <span class=\"fa fa-check\"></span>\\n     {{\\'Terminate\\' | translate}}\\n</a>\\n<a class=\"btn btn-default\"\\n   ng-if=\"ctrl.valid\"\\n   ng-click=\"ctrl.clear()\">\\n     <span class=\"fa fa-repeat\"></span>\\n     {{\\'Clear\\' | translate}}\\n</a>\\n<a class=\"btn btn-default\"\\n   ng-if=\"ctrl.active\"\\n   ng-click=\"ctrl.deactivate()\">\\n     <span class=\"fa fa-times\"></span>\\n     {{\\'Close\\' | translate}}\\n</a>\\n';\n\n}\nreturn __p\n}","import angular from 'angular';\nimport {interactionDecoration} from 'ngeo/misc/decorate.js';\nimport ngeoMiscFilters from 'ngeo/misc/filters.js';\nimport * as olEvents from 'ol/events.js';\nimport olStyleFill from 'ol/style/Fill.js';\nimport olStyleRegularShape from 'ol/style/RegularShape.js';\nimport olStyleStroke from 'ol/style/Stroke.js';\nimport olStyleStyle from 'ol/style/Style.js';\n\n\n/**\n * @type {!angular.IModule}\n * @hidden\n */\nconst module = angular.module('gmfMobileMeasureBase', [\n  ngeoMiscFilters.name,\n]);\n\n\n/**\n * Base controller class for Length and Area components.\n *\n * @param {!angular.IScope} $scope Angular scope.\n * @param {!angular.IFilterService} $filter Angular filter\n * @param {!angular.gettext.gettextCatalog} gettextCatalog Gettext catalog.\n * @constructor\n * @ngInject\n * @ngdoc controller\n * @ngname GmfMobileMeasureBaseController\n * @hidden\n */\nexport function MeasueMobileBaseController($scope, $filter, gettextCatalog) {\n\n  /**\n   * @type {angular.IScope}\n   * @protected\n   */\n  this.scope = $scope;\n\n  /**\n   * @type {angular.IFilterService}\n   * @protected\n   */\n  this.filter = $filter;\n\n  /**\n   * @type {!angular.gettext.gettextCatalog}\n   * @protected\n   */\n  this.gettextCatalog = gettextCatalog;\n\n  /**\n   * @type {import(\"ol/Map.js\").default}\n   */\n  this.map;\n\n  /**\n   * @type {boolean}\n   */\n  this.active;\n\n  this.scope.$watch(() => this.active, (newVal) => {\n    this.measure.setActive(newVal);\n  });\n\n  /**\n   * @type {number|undefined}\n   */\n  this.precision;\n\n  /**\n   * @type {import(\"ol/style/Style.js\").StyleLike}\n   */\n  this.sketchStyle = new olStyleStyle({\n    fill: new olStyleFill({\n      color: 'rgba(255, 255, 255, 0.2)'\n    }),\n    stroke: new olStyleStroke({\n      color: 'rgba(0, 0, 0, 0.5)',\n      lineDash: [10, 10],\n      width: 2\n    }),\n    image: new olStyleRegularShape({\n      stroke: new olStyleStroke({\n        color: 'rgba(0, 0, 0, 0.7)',\n        width: 2\n      }),\n      points: 4,\n      radius: 8,\n      radius2: 0,\n      angle: 0\n    })\n  });\n\n  /**\n   * @type {import(\"ngeo/interaction/Measure.js\").default}\n   */\n  this.measure;\n\n  /**\n   * @type {import(\"ngeo/interaction/MobileDraw.js\").default}\n   */\n  this.drawInteraction;\n\n  /**\n   * @type {boolean}\n   */\n  this.dirty = false;\n\n  /**\n   * @type {boolean}\n   */\n  this.drawing = false;\n\n  /**\n   * @type {boolean}\n   */\n  this.valid = false;\n}\n\n\n/**\n * Initialise the controller.\n */\nMeasueMobileBaseController.prototype.init = function() {\n\n  this.measure.setActive(this.active);\n  interactionDecoration(this.measure);\n\n  this.drawInteraction = /** @type {import(\"ngeo/interaction/MobileDraw.js\").default} */ (\n    this.measure.getDrawInteraction());\n\n  const drawInteraction = this.drawInteraction;\n  interactionDecoration(drawInteraction);\n\n  Object.defineProperty(this, 'hasPoints', {\n    get() {\n      return this.drawInteraction.getFeature() !== null;\n    }\n  });\n\n  olEvents.listen(\n    drawInteraction,\n    'change:dirty',\n    (evt) => {\n      this.dirty = drawInteraction.getDirty();\n\n      // this is where the angular scope is forced to be applied. We\n      // only need to do this when dirty, as going to \"no being dirty\"\n      // is made by a click on a button where Angular is within scope\n      if (this.dirty) {\n        this.scope.$apply();\n      }\n    },\n    this\n  );\n\n  olEvents.listen(\n    drawInteraction,\n    'change:drawing',\n    (evt) => {\n      this.drawing = drawInteraction.getDrawing();\n    },\n    this\n  );\n\n  olEvents.listen(\n    drawInteraction,\n    'change:valid',\n    (evt) => {\n      this.valid = drawInteraction.getValid();\n    },\n    this\n  );\n\n  this.map.addInteraction(this.measure);\n};\n\nmodule.controller('gmfMeasueMobileBaseController', MeasueMobileBaseController);\n\nexport default module;\n","import angular from 'angular';\nimport ngeoMiscFilters from 'ngeo/misc/filters.js';\nimport ngeoInteractionMeasureLengthMobile from 'ngeo/interaction/MeasureLengthMobile.js';\nimport {MeasueMobileBaseController} from 'gmf/mobile/measure/baseComponent.js';\n\n\n/**\n * @type {!angular.IModule}\n * @hidden\n */\nconst module = angular.module('gmfMobileMeasureLength', [\n  ngeoMiscFilters.name,\n]);\n\n\nmodule.value('gmfMobileMeasureLengthTemplateUrl',\n  /**\n   * @param {JQuery} element Element.\n   * @param {angular.IAttributes} attrs Attributes.\n   * @return {string} The template url.\n   */\n  (element, attrs) => {\n    const templateUrl = attrs['gmfMobileMeasureLengthTemplateurl'];\n    return templateUrl !== undefined ? templateUrl :\n      'gmf/measure/lengthComponent';\n  });\n\nmodule.run(/* @ngInject */ ($templateCache) => {\n  // @ts-ignore: webpack\n  $templateCache.put('gmf/measure/lengthComponent', require('./baseComponent.html'));\n});\n\n\n/**\n * Provide a directive to do a length measure on the mobile devices.\n *\n * Example:\n *\n *      <div gmf-mobile-measurelength\n *        gmf-mobile-measurelength-active=\"ctrl.measureLengthActive\"\n *        gmf-mobile-measurelength-map=\"::ctrl.map\">\n *      </div>\n *\n * @htmlAttribute {boolean} gmf-mobile-measurelength-active Used to active\n * or deactivate the component.\n * @htmlAttribute {number=} gmf-mobile-measurelength-precision the number of significant digits to display.\n * @htmlAttribute {import(\"ol/Map.js\").default} gmf-mobile-measurelength-map The map.\n * @htmlAttribute {import(\"ol/style/Style.js\").StyleLike=}\n *     gmf-mobile-measurelength-sketchstyle A style for the measure length.\n * @param {string|function(!JQuery=, !angular.IAttributes=):string}\n *     gmfMobileMeasureLengthTemplateUrl Template URL for the directive.\n * @return {angular.IDirective} The Directive Definition Object.\n * @ngInject\n * @ngdoc directive\n * @ngname gmfMobileMeasureLength\n */\nfunction mobileMeasureLenthComponent(gmfMobileMeasureLengthTemplateUrl) {\n  return {\n    restrict: 'A',\n    scope: {\n      'active': '=gmfMobileMeasurelengthActive',\n      'precision': '<?gmfMobileMeasurelengthPrecision',\n      'map': '=gmfMobileMeasurelengthMap',\n      'sketchStyle': '=?gmfMobileMeasurelengthSketchstyle'\n    },\n    controller: 'GmfMobileMeasureLengthController as ctrl',\n    bindToController: true,\n    templateUrl: gmfMobileMeasureLengthTemplateUrl,\n    /**\n     * @param {angular.IScope} scope Scope.\n     * @param {JQuery} element Element.\n     * @param {angular.IAttributes} attrs Attributes.\n     * @param {Controller} controller Controller.\n     */\n    link: (scope, element, attrs, controller) => {\n      controller.init();\n    }\n  };\n}\n\n\nmodule.directive('gmfMobileMeasurelength', mobileMeasureLenthComponent);\n\n\n/**\n * @private\n * @hidden\n */\nclass Controller extends MeasueMobileBaseController {\n  /**\n   * @param {!angular.IScope} $scope Angular scope.\n   * @param {!angular.IFilterService} $filter Angular filter\n   * @param {!angular.gettext.gettextCatalog} gettextCatalog Gettext catalog.\n   * @ngInject\n   */\n  constructor($scope, $filter, gettextCatalog) {\n    super($scope, $filter, gettextCatalog);\n\n    /**\n     * @type {import(\"ngeo/interaction/MeasureLengthMobile.js\").default}\n     */\n    this.measure;\n  }\n\n  /**\n   * Initialise the controller.\n   */\n  init() {\n    this.measure = new ngeoInteractionMeasureLengthMobile(\n      this.filter('ngeoUnitPrefix'), this.gettextCatalog, {\n        precision: this.precision,\n        sketchStyle: this.sketchStyle\n      }\n    );\n\n    super.init();\n  }\n\n  /**\n   * Add current sketch point to line measure\n   */\n  addPoint() {\n    this.drawInteraction.addToDrawing();\n  }\n\n  /**\n   * Clear the sketch feature\n   */\n  clear() {\n    this.drawInteraction.clearDrawing();\n  }\n\n  /**\n   * Finish line measure\n   */\n  finish() {\n    this.drawInteraction.finishDrawing();\n  }\n\n  /**\n   * Deactivate the directive.\n   */\n  deactivate() {\n    this.active = false;\n  }\n}\n\nmodule.controller('GmfMobileMeasureLengthController', Controller);\n\n\nexport default module;\n","module.exports = function(obj) {\nobj || (obj = {});\nvar __t, __p = '';\nwith (obj) {\n__p += '<a class=\"btn btn-default\"\\n   ng-if=\"ctrl.active\"\\n   ng-click=\"ctrl.deactivate()\">\\n     <span class=\"fa fa-times\"></span>\\n     {{\\'Close\\' | translate}}\\n</a>\\n';\n\n}\nreturn __p\n}","import angular from 'angular';\nimport gmfRasterRasterService from 'gmf/raster/RasterService.js';\nimport ngeoInteractionMeasurePointMobile from 'ngeo/interaction/MeasurePointMobile.js';\nimport ngeoMiscDebounce from 'ngeo/misc/debounce.js';\nimport {interactionDecoration} from 'ngeo/misc/decorate.js';\nimport * as olEvents from 'ol/events.js';\nimport olStyleFill from 'ol/style/Fill.js';\nimport olStyleRegularShape from 'ol/style/RegularShape.js';\nimport olStyleStroke from 'ol/style/Stroke.js';\nimport olStyleStyle from 'ol/style/Style.js';\n\n\n/**\n * @type {!angular.IModule}\n * @hidden\n */\nconst module = angular.module('gmfMobileMeasurePoint', [\n  gmfRasterRasterService.name,\n  ngeoMiscDebounce.name,\n]);\n\n\nmodule.value('gmfMobileMeasurePointTemplateUrl',\n  /**\n   * @param {JQuery} element Element.\n   * @param {angular.IAttributes} attrs Attributes.\n   * @return {string} The template url.\n   */\n  (element, attrs) => {\n    const templateUrl = attrs['gmfMobileMeasurePointTemplateurl'];\n    return templateUrl !== undefined ? templateUrl :\n      'gmf/measure/pointComponent';\n  });\n\nmodule.run(/* @ngInject */ ($templateCache) => {\n  // @ts-ignore: webpack\n  $templateCache.put('gmf/measure/pointComponent', require('./pointComponent.html'));\n});\n\n\n/**\n * Provide a directive to do a point (coordinate and elevation) measure on the\n * mobile devices.\n *\n * Example:\n *\n *      <div gmf-mobile-measurepoint\n *        gmf-mobile-measurepoint-active=\"ctrl.measurePointActive\"\n *        gmf-mobile-measurepoint-layersconfig=\"::ctrl.measurePointLayers\"\n *        gmf-mobile-measurepoint-map=\"::ctrl.map\">\n *      </div>\n *\n * Where ctrl.measurePointLayers is an object like this:\n *\n *      this.measurePointLayers = [\n *        {name: 'srtm', unit: 'm', decimals: 2},\n *        {name: 'wind', {unit: 'km/h'},\n *        {name: 'humidity'}\n *      ];\n *\n * @htmlAttribute {boolean} gmf-mobile-measurepoint-active Used to active\n * or deactivate the component.\n * @htmlAttribute {number=} gmf-mobile-measurepoint-coordinatedecimals number\n *     of decimal to display for the coordinate.\n * @htmlAttribute {Array<LayerConfig>}\n *     gmf-mobile-measurepoint-layersconfig Raster elevation layers to get\n *     information under the point and its configuaration.\n * @htmlAttribute {import(\"ol/Map.js\").default} gmf-mobile-measurepoint-map The map.\n * @htmlAttribute {import(\"ol/style/Style.js\").StyleLike=}\n *     gmf-mobile-measurepoint-sketchstyle A style for the measure point.\n * @param {string|function(!JQuery=, !angular.IAttributes=): string}\n *     gmfMobileMeasurePointTemplateUrl Template URL for the directive.\n * @return {angular.IDirective} The Directive Definition Object.\n * @ngInject\n * @ngdoc directive\n * @ngname gmfMobileMeasurePoint\n */\nfunction mobileMeasurePointComponent(gmfMobileMeasurePointTemplateUrl) {\n  return {\n    restrict: 'A',\n    scope: {\n      'active': '=gmfMobileMeasurepointActive',\n      'getCoordinateDecimalsFn': '&?gmfMobileMeasurepointCoordinatedecimals',\n      'getLayersConfigFn': '&gmfMobileMeasurepointLayersconfig',\n      'map': '=gmfMobileMeasurepointMap',\n      'sketchStyle': '=?gmfMobileMeasurepointSketchstyle',\n      'format': '<gmfMobileMeasurepointFormat'\n    },\n    controller: 'GmfMobileMeasurePointController as ctrl',\n    bindToController: true,\n    templateUrl: gmfMobileMeasurePointTemplateUrl,\n    /**\n     * @param {!angular.IScope} scope Scope.\n     * @param {!JQuery} element Element.\n     * @param {!angular.IAttributes} attrs Attributes.\n     * @param {!MobileMeasurePointController} controller Controller.\n     */\n    link: (scope, element, attrs, controller) => {\n      controller.init();\n    }\n  };\n}\n\n\nmodule.directive('gmfMobileMeasurepoint', mobileMeasurePointComponent);\n\n\n/**\n * @param {angular.gettext.gettextCatalog} gettextCatalog Gettext catalog.\n * @param {!angular.IScope} $scope Angular scope.\n * @param {angular.IFilterService} $filter Angular filter service.\n * @param {import(\"gmf/raster/RasterService.js\").RasterService} gmfRaster gmf Raster service.\n * @param {import(\"ngeo/misc/debounce.js\").miscDebounce<function(): void>} ngeoDebounce ngeo Debounce factory.\n * @constructor\n * @hidden\n * @ngInject\n * @ngdoc controller\n * @ngname GmfMobileMeasurePointController\n */\nexport function MobileMeasurePointController(gettextCatalog, $scope, $filter, gmfRaster, ngeoDebounce) {\n\n  /**\n   * @type {import(\"gmf/raster/RasterService.js\").RasterService}\n   * @private\n   */\n  this.gmfRaster_ = gmfRaster;\n\n  /**\n   * @type {import(\"ngeo/misc/debounce.js\").miscDebounce<function(): void>}\n   * @private\n   */\n  this.ngeoDebounce_ = ngeoDebounce;\n\n  /**\n   * @type {angular.gettext.gettextCatalog}\n   * @private\n   */\n  this.gettextCatalog_ = gettextCatalog;\n\n  /**\n   * @type {angular.IFilterService}\n   * @private\n   */\n  this.$filter_ = $filter;\n\n  /**\n   * @type {import(\"ol/Map.js\").default}\n   */\n  this.map;\n\n  /**\n   * @type {boolean}\n   */\n  this.active;\n\n  $scope.$watch(() => this.active, (newVal) => {\n    this.measure.setActive(newVal);\n    this.handleMeasureActiveChange_();\n  });\n\n  const coordinateDecimalsFn = this['getCoordinateDecimalsFn'];\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.coordinateDecimals = coordinateDecimalsFn ? coordinateDecimalsFn() : 0;\n\n  /**\n   * @type {!Array<LayerConfig>}\n   * @private\n   */\n  this.layersConfig;\n\n  /**\n   * @type {import(\"ol/style/Style.js\").StyleLike}\n   */\n  this.sketchStyle;\n\n  if (this.sketchStyle === undefined) {\n    this.sketchStyle = new olStyleStyle({\n      fill: new olStyleFill({\n        color: 'rgba(255, 255, 255, 0.2)'\n      }),\n      stroke: new olStyleStroke({\n        color: 'rgba(0, 0, 0, 0.5)',\n        lineDash: [10, 10],\n        width: 2\n      }),\n      image: new olStyleRegularShape({\n        stroke: new olStyleStroke({\n          color: 'rgba(0, 0, 0, 0.7)',\n          width: 2\n        }),\n        points: 4,\n        radius: 8,\n        radius2: 0,\n        angle: 0\n      })\n    });\n  }\n\n  /**\n   * @type {string}\n   */\n  this.format;\n\n  /**\n   * @type {import(\"ngeo/interaction/MeasurePointMobile.js\").default}\n   */\n  this.measure;\n\n  /**\n   * @type {import(\"ngeo/interaction/MobileDraw.js\").default}\n   */\n  this.drawInteraction;\n\n  /**\n   * The key for map view 'propertychange' event.\n   * @type {?import(\"ol/events.js\").EventsKey}\n   * @private\n   */\n  this.mapViewPropertyChangeEventKey_ = null;\n}\n\n\n/**\n * Initialise the controller.\n */\nMobileMeasurePointController.prototype.init = function() {\n  this.measure = new ngeoInteractionMeasurePointMobile(\n    /** @type {import('ngeo/misc/filters.js').numberCoordinates} */ (this.$filter_('ngeoNumberCoordinates')),\n    this.format || '{x}, {y}',\n    {\n      decimals: this.coordinateDecimals,\n      sketchStyle: this.sketchStyle\n    }\n  );\n  this.measure.setActive(this.active);\n  interactionDecoration(this.measure);\n  this.drawInteraction = /** @type {import(\"ngeo/interaction/MobileDraw.js\").default} */ (\n    this.measure.getDrawInteraction());\n  interactionDecoration(this.drawInteraction);\n\n  const layersConfig = this['getLayersConfigFn']();\n  console.assert(Array.isArray(layersConfig));\n  this.layersConfig = layersConfig;\n\n  this.map.addInteraction(this.measure);\n};\n\n\n/**\n * Deactivate the directive.\n */\nMobileMeasurePointController.prototype.deactivate = function() {\n  this.active = false;\n};\n\n\n/**\n * @param {string} str String to translate.\n * @return {string} The translated text.\n */\nMobileMeasurePointController.prototype.translate = function(str) {\n  return this.gettextCatalog_.getString(str);\n};\n\n\n/**\n * Called when the measure becomes active or inactive. Act accordingly:\n * - on activate, listen to the map property changes to call for the elevation\n *   service.\n * - on deactivate, unlisten\n * @private\n * @hidden\n */\nMobileMeasurePointController.prototype.handleMeasureActiveChange_ = function() {\n  if (this.measure.getActive()) {\n    const view = this.map.getView();\n    this.mapViewPropertyChangeEventKey_ = olEvents.listen(\n      view,\n      'propertychange',\n      this.ngeoDebounce_(\n        this.getMeasure_.bind(this), 300, /* invokeApply */ true),\n      this);\n    this.getMeasure_();\n  } else if (this.mapViewPropertyChangeEventKey_) {\n    olEvents.unlistenByKey(this.mapViewPropertyChangeEventKey_);\n    this.mapViewPropertyChangeEventKey_ = null;\n  }\n};\n\n\n/**\n * Call the elevation service to get information about the measure at\n * the current map center location.\n * @private\n * @hidden\n */\nMobileMeasurePointController.prototype.getMeasure_ = function() {\n  const center = this.map.getView().getCenter();\n  console.assert(Array.isArray(center));\n  const params = {\n    'layers': this.layersConfig.map(config => config.name).join(',')\n  };\n  this.gmfRaster_.getRaster(center, params).then((object) => {\n    const el = this.measure.getTooltipElement();\n    const ctn = document.createElement('div');\n    const className = 'gmf-mobile-measure-point';\n    ctn.className = className;\n\n    for (const config of this.layersConfig) {\n      const key = config.name;\n      if (key in object) {\n        let value = object[key];\n        const childEl = document.createElement('div');\n        childEl.className = `gmf-mobile-measure-point-${key}`;\n        const unit = config.unit || '';\n        const decimals = config.decimals > 0 ? config.decimals : 0;\n        value = this.$filter_('number')(value, decimals);\n        childEl.innerHTML = [this.translate(key), ': ', value, ' ', unit].join('');\n        ctn.appendChild(childEl);\n      }\n    }\n\n    const previousCtn = el.getElementsByClassName(className);\n    if (previousCtn[0]) {\n      previousCtn[0].remove();\n    }\n    el.appendChild(ctn);\n\n  });\n};\n\n\nmodule.controller('GmfMobileMeasurePointController', MobileMeasurePointController);\n\n/**\n * @typedef {Object} LayerConfig\n * @property {string} name\n * @property {number} [decimals]\n * @property {string} [unit]\n */\n\n\nexport default module;\n","import ngeoInteractionMeasureArea from 'ngeo/interaction/MeasureArea.js';\nimport ngeoInteractionMobileDraw from 'ngeo/interaction/MobileDraw.js';\n\n/**\n * @classdesc\n * Interaction dedicated to measure Area on mobile devices.\n *\n * @constructor\n * @param {!import('ngeo/misc/filters.js').unitPrefix} format The format function\n * @param {!angular.gettext.gettextCatalog} gettextCatalog Gettext catalog.\n * @param {import('ngeo/interaction/Measure.js').MeasureOptions=} options Options\n * @private\n * @hidden\n */\nclass MeasureAreaMobile extends ngeoInteractionMeasureArea {\n  constructor(format, gettextCatalog, options = {}) {\n    Object.assign(options, {displayHelpTooltip: false});\n    super(format, gettextCatalog, options);\n  }\n\n  /**\n   * @param {import(\"ol/style/Style.js\").StyleLike|undefined} style The sketchStyle used for the drawing\n   *    interaction.\n   * @param {import(\"ol/source/Vector.js\").default} source Vector source.\n   * @return {ngeoInteractionMobileDraw} The interaction\n   */\n  createDrawInteraction(style, source) {\n    return new ngeoInteractionMobileDraw({\n      type: /** @type {import(\"ol/geom/GeometryType.js\").default} */ ('Polygon'),\n      style: style,\n      source: source,\n    });\n  }\n}\n\nexport default MeasureAreaMobile;\n","import ngeoInteractionMeasureLength from 'ngeo/interaction/MeasureLength.js';\nimport ngeoInteractionMobileDraw from 'ngeo/interaction/MobileDraw.js';\n\n/**\n * Interaction dedicated to measure length on mobile devices.\n * @hidden\n */\nexport default class extends ngeoInteractionMeasureLength {\n  /**\n   * @param {!import('ngeo/misc/filters.js').unitPrefix} format The format function\n   * @param {!angular.gettext.gettextCatalog} gettextCatalog Gettext catalog.\n   * @param {import('ngeo/interaction/Measure.js').MeasureOptions=} opt_options Options\n   */\n  constructor(format, gettextCatalog, opt_options) {\n    const options = opt_options !== undefined ? opt_options : {};\n\n    Object.assign(options, {displayHelpTooltip: false});\n\n    super(format, gettextCatalog, options);\n  }\n\n  /**\n   * @param {import(\"ol/style/Style.js\").StyleLike|undefined}\n   *     style The sketchStyle used for the drawing interaction.\n   * @param {import(\"ol/source/Vector.js\").default} source Vector source.\n   * @return {ngeoInteractionMobileDraw} The interaction\n   */\n  createDrawInteraction(style, source) {\n    return new ngeoInteractionMobileDraw({\n      type: /** @type {import(\"ol/geom/GeometryType.js\").default} */ ('LineString'),\n      style: style,\n      source: source\n    });\n  }\n}\n","import ngeoInteractionMeasure, {getFormattedPoint} from 'ngeo/interaction/Measure.js';\nimport ngeoInteractionMobileDraw from 'ngeo/interaction/MobileDraw.js';\n\n\n/**\n * Interaction dedicated to measure by coordinate (point) on mobile devices.\n * @hidden\n */\nexport default class extends ngeoInteractionMeasure {\n  /**\n   * @param {import('ngeo/misc/filters.js').numberCoordinates} format the number formatter\n   * @param {string} coordFormat the coordinates formatter\n   * @param {import('ngeo/interaction/Measure.js').MeasureOptions=} options Options\n   */\n  constructor(format, coordFormat, options = {}) {\n    Object.assign(options, {displayHelpTooltip: false});\n\n    super(options);\n\n    /**\n     * @type {import('ngeo/misc/filters.js').numberCoordinates}\n     * @private\n     */\n    this.format_ = format;\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.coordFormat_ = coordFormat;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  createDrawInteraction(style, source) {\n    return new ngeoInteractionMobileDraw({\n      type: /** @type {import(\"ol/geom/GeometryType.js\").default} */ ('Point'),\n      style: style,\n      source: source,\n    });\n  }\n\n  /**\n   * @inheritDoc\n   */\n  handleMeasure(callback) {\n    const geom = /** @type {import('ol/geom/Point.js').default} */(this.sketchFeature.getGeometry());\n    const dec = this.decimals;\n    const output = getFormattedPoint(geom, dec, this.format_, this.coordFormat_);\n    const coord = geom.getLastCoordinate();\n    callback(output, coord);\n  }\n}\n","import {getDefaultDrawStyleFunction} from 'ngeo/interaction/common.js';\nimport ngeoCustomEvent from 'ngeo/CustomEvent.js';\nimport * as olEvents from 'ol/events.js';\nimport olFeature from 'ol/Feature.js';\nimport {TRUE} from 'ol/functions.js';\nimport olGeomLineString from 'ol/geom/LineString.js';\nimport olGeomPoint from 'ol/geom/Point.js';\nimport olGeomPolygon from 'ol/geom/Polygon.js';\nimport olGeomSimpleGeometry from 'ol/geom/SimpleGeometry.js';\nimport olInteractionInteraction from 'ol/interaction/Interaction.js';\nimport olLayerVector from 'ol/layer/Vector.js';\nimport olSourceVector from 'ol/source/Vector.js';\n\n\n/**\n * MobileDraw Interaction.\n *\n * @typedef {Object} MobileDrawOptions\n * @property {number} [minPoints] The number of points that must be drawn before a polygon ring or line\n * string can be finished. Default is `3` for polygon rings and `2` for line strings.\n * @property {import(\"ol/style/Style.js\").StyleLike} [style] Style for sketch features.\n * @property {import(\"ol/geom/GeometryType.js\").default} type Drawing type ('Point' or 'LineString'.\n * @property {boolean} [wrapX] Wrap the world horizontally on the sketch overlay. Default is `false`.\n */\n\n\n/**\n * @classdesc\n * Interaction for drawing feature geometries from a mobile device using the\n * center of the map view as entry for points added.\n *\n * Supports:\n * - point\n * - line string\n * - polygon\n *\n * @constructor\n * @fires DrawEvent\n * @param {MobileDrawOptions} options Options\n * @hidden\n */\nexport default class extends olInteractionInteraction {\n  constructor(options) {\n    super({\n      handleEvent: TRUE\n    });\n\n    /**\n     * The key for view center change event.\n     * @type {?import(\"ol/events.js\").EventsKey}\n     * @private\n     */\n    this.changeEventKey_ = null;\n\n    /**\n     * Geometry type.\n     * @type {import(\"ol/geom/GeometryType.js\").default}\n     * @private\n     */\n    this.type_ = options.type;\n\n    /**\n     * The number of points that must be drawn before a polygon ring or line\n     * string can be finished.  The default is 3 for polygon rings and 2 for\n     * line strings.\n     * @type {number}\n     * @private\n     */\n    this.minPoints_ = options.minPoints ?\n      options.minPoints :\n      (this.type_ === 'Polygon' ? 3 : 2);\n\n    /**\n     * Sketch feature.\n     * @type {import(\"ol/Feature.js\").default}\n     * @private\n     */\n    this.sketchFeature_ = null;\n\n    /**\n     * Previous sketch points, saved to be able to display them on the layer.\n     * @type {Array.<import(\"ol/Feature.js\").default>}\n     * @private\n     */\n    this.sketchPoints_ = [];\n\n    /**\n     * Current sketch point.\n     * @type {import(\"ol/Feature.js\").default}\n     * @private\n     */\n    this.sketchPoint_ = null;\n\n    /**\n     * Draw overlay where our sketch features are drawn.\n     * @type {import(\"ol/layer/Vector.js\").default}\n     * @private\n     */\n    this.overlay_ = new olLayerVector({\n      source: new olSourceVector({\n        useSpatialIndex: false,\n        wrapX: options.wrapX ? options.wrapX : false\n      }),\n      style: options.style || getDefaultDrawStyleFunction(),\n      updateWhileAnimating: true,\n      updateWhileInteracting: true\n    });\n\n    olEvents.listen(this, 'change:active', this.updateState_, this);\n\n    this.set('dirty', false);\n    this.set('drawing', false);\n    this.set('valid', false);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  setMap(map) {\n    const currentMap = this.getMap();\n    if (currentMap) {\n      if (this.changeEventKey_) {\n        olEvents.unlistenByKey(this.changeEventKey_);\n      }\n    }\n\n    olInteractionInteraction.prototype.setMap.call(this, map);\n\n    if (map) {\n      this.changeEventKey_ = olEvents.listen(map.getView(),\n        'change:center',\n        this.handleViewCenterChange_, this);\n    }\n\n    this.updateState_();\n  }\n\n  // === PUBLIC METHODS - PROPERTY GETTERS ===\n\n\n  /**\n   * Return whether the interaction is currently dirty. It is if the sketch\n   * feature has its geometry last coordinate set to the center without the\n   * use of the `addToDrawing` method.\n   * @return {boolean} `true` if the interaction is dirty, `false` otherwise.\n   * @observable\n   */\n  getDirty() {\n    return /** @type {boolean} */ (\n      this.get('dirty'));\n  }\n\n  /**\n   * Return whether the interaction is currently drawing.\n   * @return {boolean} `true` if the interaction is drawing, `false` otherwise.\n   * @observable\n   */\n  getDrawing() {\n    return /** @type {boolean} */ (\n      this.get('drawing'));\n  }\n\n  /**\n   * Return whether the interaction as a valid sketch feature, i.e. its geometry\n   * is valid.\n   * @return {boolean} `true` if the interaction has a valid sketch feature,\n   *     `false` otherwise.\n   * @observable\n   */\n  getValid() {\n    return /** @type {boolean} */ (\n      this.get('valid'));\n  }\n\n  /**\n   * Returns the current sketch feature.\n   * @return {?import(\"ol/Feature.js\").default} The sketch feature, or null if none.\n   */\n  getFeature() {\n    return this.sketchFeature_;\n  }\n\n  // === PUBLIC METHODS ===\n\n\n  /**\n   * Add current sketch point to sketch feature if the latter exists, else create\n   * it.\n   */\n  addToDrawing() {\n\n    // no need to do anything if interaction is not active, nor drawing\n    const active = this.getActive();\n    const drawing = this.getDrawing();\n\n    if (!active || !drawing) {\n      return;\n    }\n\n    let sketchFeatureGeom;\n    const sketchPointGeom = this.getSketchPointGeometry_();\n    const coordinate = sketchPointGeom.getCoordinates();\n    let coordinates;\n\n    // == point ==\n    if (this.type_ === 'Point') {\n      if (!this.sketchFeature_) {\n        this.sketchFeature_ = new olFeature(new olGeomPoint(coordinate));\n        const event = new ngeoCustomEvent('drawstart', {feature: this.sketchFeature_});\n        this.dispatchEvent(event);\n      }\n      sketchFeatureGeom = this.sketchFeature_.getGeometry();\n      if (sketchFeatureGeom instanceof olGeomSimpleGeometry) {\n        sketchFeatureGeom.setCoordinates(coordinate);\n      }\n      return;\n    }\n\n    // == line string ==\n    if (this.type_ === 'LineString') {\n      this.sketchPoints_.push(this.sketchPoint_);\n      if (!this.sketchFeature_) {\n        coordinates = [coordinate.slice(), coordinate.slice()];\n        this.sketchFeature_ = new olFeature(new olGeomLineString(coordinates));\n        const event = new ngeoCustomEvent('drawstart', {feature: this.sketchFeature_});\n        this.dispatchEvent(event);\n      } else {\n        sketchFeatureGeom = this.sketchFeature_.getGeometry();\n        if (sketchFeatureGeom instanceof olGeomSimpleGeometry) {\n          coordinates = sketchFeatureGeom.getCoordinates();\n          coordinates.push(coordinate.slice());\n          sketchFeatureGeom.setCoordinates(coordinates);\n        }\n      }\n    }\n\n    // == polygon ==\n    if (this.type_ === 'Polygon') {\n      this.sketchPoints_.push(this.sketchPoint_);\n      if (!this.sketchFeature_) {\n        coordinates = [coordinate.slice(), coordinate.slice(), coordinate.slice()];\n        this.sketchFeature_ = new olFeature(new olGeomPolygon([coordinates]));\n        const event = new ngeoCustomEvent(\n          'drawstart',\n          {\n            feature: this.sketchFeature_\n          }\n        );\n        this.dispatchEvent(event);\n      } else {\n        sketchFeatureGeom = this.sketchFeature_.getGeometry();\n        if (sketchFeatureGeom instanceof olGeomPolygon) {\n          const coordinatess = sketchFeatureGeom.getCoordinates();\n          coordinates = coordinatess[0];\n          coordinates.push(coordinate.slice());\n          sketchFeatureGeom.setCoordinates(coordinatess);\n        }\n      }\n    }\n\n    const dirty = this.getDirty();\n    if (dirty) {\n      this.set('dirty', false);\n    }\n\n    // minPoints validation\n    const valid = this.getValid();\n    if (this.type_ === 'LineString' || this.type_ === 'Polygon') {\n      if (coordinates.length >= this.minPoints_) {\n        if (!valid) {\n          this.set('valid', true);\n        }\n      } else {\n        if (valid) {\n          this.set('valid', false);\n        }\n      }\n    }\n\n    // reset sketch point\n    this.sketchPoint_ = null;\n\n    // update sketch features\n    this.updateSketchFeatures_();\n  }\n\n  /**\n   * Clear the drawing\n   */\n  clearDrawing() {\n    this.setActive(false);\n    this.setActive(true);\n  }\n\n  /**\n   * Finish drawing. If there's a sketch point, it's added first.\n   */\n  finishDrawing() {\n    // no need to do anything if interaction is not active, nor drawing\n    const active = this.getActive();\n    const drawing = this.getDrawing();\n\n    if (!active || !drawing) {\n      return;\n    }\n\n    if (this.sketchPoint_) {\n      this.addToDrawing();\n    }\n\n    this.set('drawing', false);\n\n    const event = new ngeoCustomEvent('drawend', {feature: this.sketchFeature_});\n    this.dispatchEvent(event);\n  }\n\n  // === PRIVATE METHODS ===\n\n\n  /**\n   * Start drawing by adding the sketch point first.\n   * @private\n   */\n  startDrawing_() {\n    this.set('drawing', true);\n    this.createOrUpdateSketchPoint_();\n    this.updateSketchFeatures_();\n\n    if (this.type_ === 'Point') {\n      this.addToDrawing();\n    }\n  }\n\n  /**\n   * Modify the geometry of the sketch feature to have its last coordinate\n   * set to the center of the map.\n   * @private\n   */\n  modifyDrawing_() {\n    if (!this.sketchFeature_) {\n      return;\n    }\n\n    const center = this.getCenter_();\n\n    if (this.type_ === 'LineString') {\n      const sketchFeatureGeom = this.sketchFeature_.getGeometry();\n      if (sketchFeatureGeom instanceof olGeomSimpleGeometry) {\n        const coordinates = sketchFeatureGeom.getCoordinates();\n        coordinates.pop();\n        coordinates.push(center);\n        sketchFeatureGeom.setCoordinates(coordinates);\n      }\n    } else if (this.type_ === 'Polygon') {\n      const sketchFeatureGeom = this.sketchFeature_.getGeometry();\n      if (sketchFeatureGeom instanceof olGeomPolygon) {\n        const coordinatess = sketchFeatureGeom.getCoordinates();\n        const coordinates = coordinatess[0];\n        coordinates.pop();\n        coordinates.push(center);\n        sketchFeatureGeom.setCoordinates([coordinates]);\n      }\n    }\n\n    const dirty = this.getDirty();\n    if (!dirty) {\n      this.set('dirty', true);\n    }\n  }\n\n  /**\n   * Stop drawing without adding the sketch feature to the target layer.\n   * @return {?import(\"ol/Feature.js\").default} The sketch feature (or null if none).\n   * @private\n   */\n  abortDrawing_() {\n    const sketchFeature = this.sketchFeature_;\n    if (sketchFeature || this.sketchPoints_.length > 0) {\n      this.sketchFeature_ = null;\n      this.sketchPoint_ = null;\n      /** @type {olSourceVector} */(this.overlay_.getSource()).clear(true);\n    }\n    this.sketchPoints_ = [];\n    this.set('dirty', false);\n    this.set('drawing', false);\n    this.set('valid', false);\n    return sketchFeature;\n  }\n\n  /**\n   * @private\n   */\n  updateState_() {\n    const map = this.getMap();\n    const active = this.getActive();\n    if (!map || !active) {\n      this.abortDrawing_();\n    } else {\n      this.startDrawing_();\n    }\n    this.overlay_.setMap(active ? map : null);\n  }\n\n  /**\n   * @param {import(\"ol/events/Event.js\").default} evt Event.\n   * @private\n   */\n  handleViewCenterChange_(evt) {\n    // no need to do anything if interaction is not active, nor drawing\n    const active = this.getActive();\n    const drawing = this.getDrawing();\n\n    if (!active || !drawing) {\n      return;\n    }\n\n    this.createOrUpdateSketchPoint_();\n\n    if (this.type_ === 'Point') {\n      this.addToDrawing();\n    } else {\n      this.modifyDrawing_();\n      this.updateSketchFeatures_();\n    }\n  }\n\n  /**\n   * @private\n   */\n  createOrUpdateSketchPoint_() {\n    const center = this.getCenter_();\n\n    if (this.sketchPoint_) {\n      const geometry = this.getSketchPointGeometry_();\n      geometry.setCoordinates(center);\n    } else {\n      this.sketchPoint_ = new olFeature(new olGeomPoint(center));\n    }\n  }\n\n  /**\n   * Redraw the sketch features.\n   * @private\n   */\n  updateSketchFeatures_() {\n    const sketchFeatures = [];\n    if (this.sketchFeature_) {\n      sketchFeatures.push(this.sketchFeature_);\n    }\n    if (this.sketchPoint_) {\n      sketchFeatures.push(this.sketchPoint_);\n    }\n    const overlaySource = /** @type {olSourceVector} */(this.overlay_.getSource());\n    overlaySource.clear(true);\n    overlaySource.addFeatures(sketchFeatures);\n    overlaySource.addFeatures(this.sketchPoints_);\n  }\n\n  /**\n   * Returns the geometry of the sketch point feature.\n   * @return {import(\"ol/geom/Point.js\").default} Point.\n   * @private\n   */\n  getSketchPointGeometry_() {\n    console.assert(this.sketchPoint_, 'sketch point should be thruty');\n    const geometry = this.sketchPoint_.getGeometry();\n    if (geometry instanceof olGeomPoint) {\n      return geometry;\n    } else {\n      throw 'Wrong geometry type';\n    }\n  }\n\n  /**\n   * Returns the center of the map view\n   * @return {import(\"ol/coordinate.js\").Coordinate} Coordinate.\n   * @private\n   */\n  getCenter_() {\n    const center = this.getMap().getView().getCenter();\n    console.assert(Array.isArray(center));\n    return center;\n  }\n}\n"],"sourceRoot":""}