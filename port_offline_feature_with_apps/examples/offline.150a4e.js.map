{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/offline/NetworkStatus.js","webpack:///./src/offline/component.js","webpack:///./src/offline/ServiceManager.js","webpack:///./src/offline/TilesDownloader.js","webpack:///./src/offline/Downloader.js","webpack:///./src/offline/Restorer.js","webpack:///./src/offline/Mode.js","webpack:///./src/offline/module.js","webpack:///./src/offline/SerializerDeserializer.js","webpack:///./src/offline/AbstractLocalforageWrapper.js","webpack:///./src/offline/LocalforageCordovaWrapper.js","webpack:///./src/offline/LocalforageAndroidWrapper.js","webpack:///./src/offline/LocalforageIosWrapper.js","webpack:///./src/offline/utils.js","webpack:///./src/offline/Configuration.js","webpack:///./examples/offline.js","webpack:///./src/offline/component.html"],"names":["webpackJsonpCallback","data","chunkIds","moreModules","executeModules","moduleId","chunkId","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","12","exports","module","l","m","c","d","name","getter","o","defineProperty","configurable","enumerable","get","r","value","n","__esModule","getDefault","getModuleExports","object","property","p","jsonpArray","window","oldJsonpFunction","bind","slice","httpInterceptor","$q","ngeoDebounce","ngeoNetworkStatus","debouncedCheck","check","undefined","request","config","requestError","rejection","reject","response","responseError","Service","$inject","$document","$window","$timeout","$rootScope","ngeoOfflineTestUrl","_classCallCheck","this","$document_","$window_","$timeout_","$rootScope_","ngeoOfflineTestUrl_","count_","offline_","promise_","initialize_","_this","navigator","onLine","addEventListener","triggerChangeStatusEvent_","ajaxError","evt","jqxhr","settings","thrownError","test","timeout","_this2","cancel","$","ajax","method","url","success","error","offline","$digest","isDisconnected","angular","ngeoMiscDebounce","factory","service","configFunction_","$httpProvider","interceptors","ngeoMapFeatureOverlayMgr","ngeoMessageModalComponent","element","attrs","templateUrl","run","$templateCache","put","require","ngeoOfflineTemplateUrl","$element","$attrs","component_","bindings","map","extentSize","maskMargin","minZoom","maxZoom","controller","component","Controller","_class","ngeoFeatureOverlayMgr","ngeoOfflineServiceManager","ngeoOfflineConfiguration","ngeoOfflineMode","ngeoOfflineServiceManager_","ngeoOfflineConfiguration_","offlineMode","networkStatus","featuresOverlay_","getFeatureOverlay","overlayCollection_","olCollection","setFeatures","postcomposeListener_","postComposeListenerKey_","dataPolygon_","selectingExtent","downloading","progressPercents","menuDisplayed","displayAlertAbortDownload","displayAlertLoadData","displayAlertNoLayer","originalMinZoom","originalMaxZoom","estimatedLoadDataSize","progressCallback_","event","progress","detail","Math","floor","finishDownload_","$onInit","registerComponent","createMaskPostcompose_","on","$onDestroy","un","hasData","hasOfflineData","computeSizeAndDisplayAlertLoadData","estimateLoadDataSize","toggleViewExtentSelection","finished","unByKey","removeZoomConstraints_","addZoomConstraints_","render","validateExtent","extent","getDowloadExtent_","save","askAbortDownload","abortDownload","deleteData","showMenu","activateOfflineMode","restore","then","createPolygonFromExtent_","size","getSize","getView","fit","displayExtent_","enable","deactivateOfflineMode","location","reload","toggleExtentVisibility","isExtentVisible","clear","getLength","_this3","reloadIfInOfflineMode","isEnabled","feature","olFeature","view","zoom","getZoom","getMinZoom","getMaxZoom","setZoom","setMaxZoom","setMinZoom","_this4","context","frameState","resolution","viewState","viewportWidth","pixelRatio","viewportHeight","center","extentLength","DEVICE_PIXEL_RATIO","min","extentHalfLength","ceil","beginPath","moveTo","lineTo","closePath","createExtent_","fillStyle","fill","projExtent","getProjection","getExtent","olGeomPolygon","extentToRectangle","olGeomGeometryLayout","XY","halfLength","minx","miny","maxx","maxy","getCenter","getExtentSize_","mapSize","maskSizePixel","maskSizeMeter","getResolution","$injector","ServiceManager_classCallCheck","$injector_","saveService_","restoreService_","getOfflineService_","serviceLike","has","console","setSaveService","saveLikeService","setRestoreService","restoreLikeService","warn","Promise","blobToDataUrl","blob","resolve","reader","FileReader","onload","onerror","readAsDataURL","tiles","callbacks","workers","TilesDownloader_classCallCheck","maxNumberOfWorkers_","wasStarted_","tiles_","callbacks_","allCount_","okCount_","koCount_","requestedCount_","resolvePromise_","tileIndex_","cancel_","downloadTile_","tile","tileUrl","xhr","XMLHttpRequest","open","responseType","onTileDownloaded","errorCallback","e","onTileDownloadError","onloadCallback","target","dataUrl","onTileDownloadSuccess","onabort","ontimeout","send","download","googAsserts","assert","magnitude2","a","b","magnitudeSquared","pow","Downloader","Downloader_classCallCheck","configuration_","tileDownloader_","queueLayerTiles_","layerMetadata","queue","source","extentByZoom","olSourceTileWMS","olSourceWMTS","projection","tileGrid","getTileGrid","tileUrlFunction","getTileUrlFunction","_loop","extentZoom","z","queueByZ","minX","minY","maxX","maxY","forEachTileCoord","coord","centerTileCoord","sort","_iterator","_isArray","Array","isArray","_i","Symbol","iterator","_ref","next","done","layersMetadatas","createLayerMetadatas","persistentLayers","zooms","_iterator2","_isArray2","_i2","_ref2","layerItem","layerType","backgroundLayer","layerSerialization","key","getLayerKey","forEach","obj","indexOf","persistentObject","layers","setOfflineContentPromise","setItem","TilesDownloader","getMaxNumberOfParallelDownloads","tileDownloadPromise","allPromise","all","setHasOfflineData","Restorer","ngeoBackgroundLayerMgr","Restorer_classCallCheck","ngeoBackgroundLayerMgr_","getItem","offlineContent","doRestore","getLayerGroup","getLayers","offlineLayer","layer","recreateOfflineLayer","addLayer","set","ngeoMapBackgroundLayerMgr","Mode_classCallCheck","enabled_","ngeoOfflineComponent","ngeoOfflineNetworkStatus","downloader","restorer","mode","SerDes","gutter","SerializerDeserializer_classCallCheck","gutter_","createBaseObject_","olObject","properties","getProperties","typeOf","_typeof","serializeTilegrid","tilegrid","getOrigin","getResolutions","getTileSize","JSON","stringify","deserializeTilegrid","serialization","options","parse","olTilegridTileGrid","serializeTilegridWMTS","resolutions","getMatrixIds","deserializeTilegridWMTS","olTilegridWMTS","serializeSourceTileWMS","getParams","getUrls","olProj","getCode","deserializeSourceTileWMS","tileLoadFunction","serializeSourceWMTS","getDimensions","getFormat","getVersion","getLayer","getStyle","getMatrixSet","tileGridWMTS","getRequestEncoding","deserializeSourceWMTS","makeInfinitySerializable_","number","Infinity","serializeTileLayer","getOpacity","getVisible","getMinResolution","getMaxResolution","getZIndex","getSource","deserializeTileLayer","sourceType","olLayerTile","Action","AbstractLocalforageWrapper","AbstractLocalforageWrapper_classCallCheck","waitingPromises_","Map","currentId_","_len","arguments","args","_key","createAction","concat","_len2","_key2","_len3","_key3","command","_len4","_key4","id","action","plugin","log","waitingPromise","promise","postToBackend","receiveMessage","msg","delete","_inherits","CordovaWrapper","_AbstractWrapper","LocalforageCordovaWrapper_classCallCheck","_possibleConstructorReturn","postMessage","AbstractWrapper","LocalforageAndroidWrapper_inherits","AndroidWrapper","LocalforageAndroidWrapper_classCallCheck","LocalforageAndroidWrapper_possibleConstructorReturn","stringified","receiveFromAndroid","actionString","LocalforageIosWrapper_inherits","IosWrapper","LocalforageIosWrapper_classCallCheck","LocalforageIosWrapper_possibleConstructorReturn","receiveFromIos","item","traverseLayer","ancestors","visitor","descend","olLayerGroup","childLayer","extractor","RegExp","normalizeURL","matches","match","defaultImageLoadFunction","olSourceImage","Configuration_inherits","_olObservable","ngeoOfflineGutter","Configuration_classCallCheck","Configuration_possibleConstructorReturn","localforage_","createLocalforage","configureLocalforage","rootScope_","initializeHasOfflineData","serDes_","SerializerDeserializer","dispatchProgress_","dispatchEvent","ngeoCustomEvent","needDigest","$applyAsync","traceGetSetItem","search","includes","LocalforageCordovaWrapper","LocalforageAndroidWrapper","LocalforageIosWrapper","realLocalforage","version","storeName","removeItem","utils","getExtentByZoom","userExtent","currentZoom","results","dz","sourceImageWMSToTileWMS","olSourceImageWMS","getUrl","getImageLoadFunction","createTileGridForProjection","attributions","getAttributions","params","layersItems","visitLayer","olLayerLayer","olLayerImage","olLayerVector","root","createTileLoadFunction_","that","imageTile","src","content","getImage","olObservable","ngeoMapModule","ngeoOfflineModule","NgeoOfflineServiceManager","MainController","offline_classCallCheck","offlineExtentSize","olMap","olSourceOSM","olView","init"],"mappings":"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","file":"offline.150a4e.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t12: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([366,0]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","/**\n * @module ngeo.offline.NetworkStatus\n */\nimport ngeoMiscDebounce from 'ngeo/misc/debounce.js';\n\n\n/**\n * @ngInject\n * @param {angular.$q} $q The Angular $q service.\n * @param {ngeox.miscDebounce} ngeoDebounce ngeo debounce service.\n * @param {ngeo.offline.NetworkStatus} ngeoNetworkStatus ngeo network status service.\n * @return {angular.$http.Interceptor} the interceptor\n */\nconst httpInterceptor = function($q, ngeoDebounce, ngeoNetworkStatus) {\n  const debouncedCheck = ngeoDebounce(() => ngeoNetworkStatus.check(undefined), 2000, false);\n  return {\n    request(config) {\n      return config;\n    },\n    requestError(rejection) {\n      return $q.reject(rejection);\n    },\n    response(response) {\n      return response;\n    },\n    responseError(rejection) {\n      debouncedCheck();\n      return $q.reject(rejection);\n    }\n  };\n};\n\nconst Service = class {\n\n  /**\n   * This service watches the status of network connection.\n   *\n   * Currently it watches every $http and $.ajax requests errors, if an error\n   * occurs we wait 2 sec then we make an http request on the checker file.\n   * If the checker responds that means we are online, otherwise we make a\n   * 2nd request 2 sec later, if the 2nd requests failed that means we\n   * are offline.\n   *\n   * A timeout of 1 sec is set for the checker file, so if we have a bad\n   * connection, we consider we are offline.\n   *\n   * During offline mode we test every 2 sec if we are back online.\n   *\n   * @ngInject\n   * @param {!jQuery} $document Angular document service.\n   * @param {angular.$window} $window Angular window service.\n   * @param {!angular.$timeout} $timeout Angular timeout service.\n   * @param {angular.Scope} $rootScope The root scope.\n   * @param {string} ngeoOfflineTestUrl Url of the test page.\n   */\n  constructor($document, $window, $timeout, $rootScope, ngeoOfflineTestUrl) {\n\n    /**\n     * @private\n     * @type {!jQuery}\n     */\n    this.$document_ = $document;\n\n    /**\n     * @private\n     * @type {!Window}\n     */\n    this.$window_ = $window;\n\n    /**\n     * @private\n     * @type {!angular.$timeout}\n     */\n    this.$timeout_ = $timeout;\n\n    /**\n     * @private\n     * @type {angular.Scope}\n     */\n    this.$rootScope_ = $rootScope;\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.ngeoOfflineTestUrl_ = ngeoOfflineTestUrl;\n\n    /**\n     * @private\n     * @type {!number}\n     */\n    this.count_ = 0;\n\n    /**\n     * @type {!boolean|undefined}\n     * @private\n     */\n    this.offline_;\n\n    /**\n     * @private\n     * @type {angular.$q.Promise|undefined}\n     */\n    this.promise_;\n\n    this.initialize_();\n\n  }\n\n  initialize_() {\n    this.offline_ = !this.$window_.navigator.onLine;\n\n    // airplane mode, works offline(firefox)\n    this.$window_.addEventListener('offline', () => {\n      this.triggerChangeStatusEvent_(true);\n    });\n\n    // online event doesn't means we have a internet connection, that means we\n    // have possiby one (connected to a router ...)\n    this.$window_.addEventListener('online', () => {\n      this.check(undefined);\n    });\n\n    // We catch every $.ajax request errors or (canceled request).\n    this.$document_.ajaxError((evt, jqxhr, settings, thrownError) => {\n      // Filter out canceled requests\n      if (!/^(canceled|abort)$/.test(thrownError)) {\n        this.check(2000);\n      }\n    });\n\n  }\n\n  /**\n   * Check fir network status\n   *\n   * @param {number=} timeout Delay for timeout.\n   */\n  check(timeout) {\n    if (this.promise_) {\n      this.$timeout_.cancel(this.promise_);\n      this.promise_ = undefined;\n    }\n    if (timeout !== undefined) {\n      this.count_++;\n      this.promise_ = this.$timeout_(() => this.check(), timeout);\n      return;\n    }\n    $.ajax({\n      method: 'GET',\n      url: this.ngeoOfflineTestUrl_,\n      timeout: 1000,\n      success: () => {\n        this.count_ = 0;\n        if (this.offline_) {\n          this.triggerChangeStatusEvent_(false);\n        }\n      },\n      error: () => {\n        this.count_++;\n        // We consider we are offline after 3 requests failed\n        if (this.count_ > 2 && !this.offline_) {\n          this.triggerChangeStatusEvent_(true);\n        }\n      }\n    });\n\n  }\n\n  /**\n   * @param {boolean} offline whether it's offline or not.\n   * @private\n   */\n  triggerChangeStatusEvent_(offline) {\n    this.offline_ = offline;\n    // this.$rootScope_.$broadcast('ngeoNetworkStatusChange', net.offline);\n    this.$rootScope_.$digest();\n  }\n\n  /**\n   * @return {boolean} True if we are disconnected.\n   * @export\n   */\n  isDisconnected() {\n    return !!this.offline_;\n  }\n};\n\nconst name = 'ngeoNetworkStatus';\n\nService.module = angular.module(name, [\n  ngeoMiscDebounce.name\n]);\nService.module.factory('httpInterceptor', httpInterceptor);\nService.module.service(name, Service);\n\n/**\n * @ngInject\n * @private\n * @param {angular.$HttpProvider} $httpProvider .\n */\nService.module.configFunction_ = function($httpProvider) {\n  $httpProvider.interceptors.push('httpInterceptor');\n};\nService.module.config(Service.module.configFunction_);\n\nService.module.value('ngeoOfflineTestUrl', '');\n\nconst exports = Service;\n\n\nexport default exports;\n","/**\n * @module ngeo.offline.component\n */\nimport ngeoMapFeatureOverlayMgr from 'ngeo/map/FeatureOverlayMgr.js';\nimport ngeoMessageModalComponent from 'ngeo/message/modalComponent.js';\nimport {extentToRectangle} from 'ngeo/utils.js';\nimport olCollection from 'ol/Collection.js';\nimport {unByKey} from 'ol/Observable.js';\nimport olFeature from 'ol/Feature.js';\nimport olGeomPolygon from 'ol/geom/Polygon.js';\nimport olGeomGeometryLayout from 'ol/geom/GeometryLayout.js';\nimport {DEVICE_PIXEL_RATIO} from 'ol/has.js';\n\n/**\n * @type {!angular.Module}\n */\nconst exports = angular.module('ngeoOffline', [\n  ngeoMapFeatureOverlayMgr.module.name,\n  ngeoMessageModalComponent.name\n]);\n\nexports.value('ngeoOfflineTemplateUrl',\n  /**\n   * @param {angular.JQLite} element Element.\n   * @param {angular.Attributes} attrs Attributes.\n   * @return {string} Template URL.\n   */\n  (element, attrs) => {\n    const templateUrl = attrs['ngeoOfflineTemplateurl'];\n    return templateUrl !== undefined ? templateUrl :\n      'ngeo/offline/component.html';\n  });\n\nexports.run(/* @ngInject */ ($templateCache) => {\n  $templateCache.put('ngeo/offline/component.html', require('./component.html'));\n});\n\n/**\n * @param {!angular.JQLite} $element Element.\n * @param {!angular.Attributes} $attrs Attributes.\n * @param {!function(!angular.JQLite, !angular.Attributes): string} ngeoOfflineTemplateUrl Template function.\n * @return {string} Template URL.\n * @ngInject\n */\nfunction ngeoOfflineTemplateUrl($element, $attrs, ngeoOfflineTemplateUrl) {\n  return ngeoOfflineTemplateUrl($element, $attrs);\n}\n\n\n/**\n * Provides the \"offline\" component.\n *\n * Example:\n *\n *     <ngeo-offline\n *       ngeo-offline-map=\"ctrl.map\"\n *       ngeo-offline-extentsize=\"ctrl.offlineExtentSize\">\n *       ngeo-offline-mask-margin=\"::100\"\n *       ngeo-offline-min_zoom=\"::11\"\n *       ngeo-offline-max_zoom=\"::15\"\n *     </ngeo-offline>\n *\n * See our live example: [../examples/offline.html](../examples/offline.html)\n *\n * @htmlAttribute {ol.Map} ngeo-offline-map The map.\n * @htmlAttribute {number} ngeo-offline-extentsize The size, in map units, of a side of the extent.\n * @private\n * @ngdoc component\n * @ngname ngeoOffline\n */\nexports.component_ = {\n  bindings: {\n    'map': '<ngeoOfflineMap',\n    'extentSize': '<?ngeoOfflineExtentsize',\n    'maskMargin': '<?ngeoOfflineMaskMargin',\n    'minZoom': '<?ngeoOfflineMinZoom',\n    'maxZoom': '<?ngeoOfflineMaxZoom',\n  },\n  controller: 'ngeoOfflineController',\n  templateUrl: ngeoOfflineTemplateUrl\n};\n\n\nexports.component('ngeoOffline', exports.component_);\n\n\n/**\n * @private\n */\nexports.Controller = class {\n\n  /**\n   * @private\n   * @param {angular.$timeout} $timeout Angular timeout service.\n   * @param {ngeo.map.FeatureOverlayMgr} ngeoFeatureOverlayMgr ngeo feature overlay manager service.\n   * @param {ngeo.offline.ServiceManager} ngeoOfflineServiceManager ngeo offline service Manager.\n   * @param {ngeo.offline.Configuration} ngeoOfflineConfiguration ngeo offline configuration service.\n   * @param {ngeo.offline.Mode} ngeoOfflineMode Offline mode manager.\n   * @param {ngeo.offline.NetworkStatus} ngeoNetworkStatus ngeo network status service.\n   * @ngInject\n   * @ngdoc controller\n   * @ngname ngeoOfflineController\n   */\n  constructor($timeout, ngeoFeatureOverlayMgr, ngeoOfflineServiceManager, ngeoOfflineConfiguration, ngeoOfflineMode, ngeoNetworkStatus) {\n\n    /**\n     * @type {angular.$timeout}\n     * @private\n     */\n    this.$timeout_ = $timeout;\n\n    /**\n     * @type {ngeo.offline.ServiceManager}\n     * @private\n     */\n    this.ngeoOfflineServiceManager_ = ngeoOfflineServiceManager;\n\n    /**\n     * @private\n     * @type {ngeo.offline.Configuration}\n     */\n    this.ngeoOfflineConfiguration_ = ngeoOfflineConfiguration;\n\n    /**\n     * @type {ngeo.offline.Mode}\n     * @export\n     */\n    this.offlineMode = ngeoOfflineMode;\n\n    /**\n     * @type {ngeo.offline.NetworkStatus}\n     * @export\n     */\n    this.networkStatus = ngeoNetworkStatus;\n\n    /**\n     * The map.\n     * @type {!ol.Map}\n     * @export\n     */\n    this.map;\n\n    /**\n     * The size, in map units, of a side of the extent.\n     * @type {number}\n     * @export\n     */\n    this.extentSize;\n\n    /**\n     * @type {ngeo.map.FeatureOverlay}\n     * @private\n     */\n    this.featuresOverlay_ = ngeoFeatureOverlayMgr.getFeatureOverlay();\n\n    /**\n     * @type {!ol.Collection}\n     * @private\n     */\n    this.overlayCollection_ = new olCollection();\n\n    this.featuresOverlay_.setFeatures(this.overlayCollection_);\n\n    /**\n     * @type {function(ol.render.Event)}\n     */\n    this.postcomposeListener_;\n\n    /**\n     * @type {ol.EventsKey|Array.<ol.EventsKey>}\n     * @private\n     */\n    this.postComposeListenerKey_ = null;\n\n\n    /**\n     * @type {ol.geom.Polygon}\n     * @private\n     */\n    this.dataPolygon_ = null;\n\n    /**\n     * Whether the current view is the extent selection.\n     * @type {boolean}\n     * @export\n     */\n    this.selectingExtent = false;\n\n    /**\n     * Whether the current view is downloading one.\n     * @type {boolean}\n     * @export\n     */\n    this.downloading = false;\n\n    /**\n     * The progression of the data loading (0-100%).\n     * @type {number}\n     * @export\n     */\n    this.progressPercents = 0;\n\n    /**\n     * Whether the menu is currently displayed.\n     * @type {boolean}\n     * @export\n     */\n    this.menuDisplayed = false;\n\n    /**\n     * Whether the cancel download modal is displayed.\n     * @type {boolean}\n     * @export\n     */\n    this.displayAlertAbortDownload = false;\n\n    /**\n     * Whether the load data modal is displayed.\n     * @type {boolean}\n     * @export\n     */\n    this.displayAlertLoadData = false;\n\n    /**\n     * Whether the \"no layer\" modal is displayed.\n     * @type {boolean}\n     * @export\n     */\n    this.displayAlertNoLayer = false;\n\n    /**\n     * Offline mask minimum margin in pixels.\n     * @type {number}\n     * @export\n     */\n    this.maskMargin;\n\n    /**\n     * Minimum zoom where offline is enable.\n     * @type {number}\n     * @export\n     */\n    this.minZoom;\n\n    /**\n     * Maximum zoom where offline is enable.\n     * @type {number}\n     * @export\n     */\n    this.maxZoom;\n\n    /**\n     * Map view max zoom constraint.\n     * @type {number}\n     * @export\n     */\n    this.originalMinZoom;\n\n    /**\n     * Map view min zoom constraint.\n     * @type {number}\n     * @export\n     */\n    this.originalMaxZoom;\n\n    /**\n     * @type {number}\n     * @export\n     */\n    this.estimatedLoadDataSize;\n\n    /**\n     * @private\n     * @param {ngeo.CustomEvent} event the progress event.\n     */\n    this.progressCallback_ = (event) => {\n      const progress = event.detail['progress'];\n      this.progressPercents = Math.floor(progress * 100);\n      if (progress === 1) {\n        this.finishDownload_();\n      }\n      this.$timeout_(() => {}, 0); // FIXME: force redraw\n    };\n  }\n\n  $onInit() {\n    this.offlineMode.registerComponent(this);\n    this.postcomposeListener_ = this.createMaskPostcompose_();\n    this.ngeoOfflineConfiguration_.on('progress', this.progressCallback_);\n    this.maskMargin = this.maskMargin || 100;\n    this.minZoom = this.minZoom || 10;\n    this.maxZoom = this.maxZoom || 15;\n  }\n\n  $onDestroy() {\n    this.ngeoOfflineConfiguration_.un('progress', this.progressCallback_);\n  }\n\n  /**\n   * @return {boolean} True if data are accessible offline.\n   * @export\n   */\n  hasData() {\n    return this.ngeoOfflineConfiguration_.hasOfflineData();\n  }\n\n  /**\n   * @export\n   */\n  computeSizeAndDisplayAlertLoadData() {\n    this.estimatedLoadDataSize = this.ngeoOfflineConfiguration_.estimateLoadDataSize(this.map);\n    if (this.estimatedLoadDataSize > 0) {\n      this.displayAlertLoadData = true;\n    } else {\n      this.displayAlertNoLayer = true;\n    }\n  }\n  /**\n   * Toggle the selecting extent view.\n   * @param {boolean=} finished If just finished downloading.\n   * @export\n   */\n  toggleViewExtentSelection(finished) {\n    this.menuDisplayed = false;\n    this.selectingExtent = !this.selectingExtent;\n\n    if (this.postComposeListenerKey_) {\n      unByKey(this.postComposeListenerKey_);\n      this.postComposeListenerKey_ = null;\n      this.removeZoomConstraints_();\n    }\n    if (this.selectingExtent && !this.postComposeListenerKey_) {\n      this.addZoomConstraints_();\n      this.postComposeListenerKey_ = this.map.on('postcompose', this.postcomposeListener_);\n    }\n    this.map.render();\n  }\n\n  /**\n   * Validate the current extent and download data.\n   * @export\n   */\n  validateExtent() {\n    this.progressPercents = 0;\n    const extent = this.getDowloadExtent_();\n    this.ngeoOfflineServiceManager_.save(extent, this.map);\n    this.downloading = true;\n  }\n\n\n  /**\n   * @private\n   */\n  finishDownload_() {\n    this.downloading = false;\n    this.toggleViewExtentSelection(true);\n  }\n\n  /**\n   * Ask to abort the download of data.\n   * @export\n   */\n  askAbortDownload() {\n    this.displayAlertAbortDownload = true;\n  }\n\n  /**\n   * Abort the download of data.\n   * @export\n   */\n  abortDownload() {\n    this.downloading = false;\n    this.ngeoOfflineServiceManager_.cancel();\n    this.deleteData();\n  }\n\n  /**\n   * Show the main menu.\n   * @export\n   */\n  showMenu() {\n    this.menuDisplayed = true;\n  }\n\n  /**\n   * Activate offline mode.\n   * Zoom to the extent of that data and restore the data.\n   * @export\n   */\n  activateOfflineMode() {\n    this.ngeoOfflineServiceManager_.restore(this.map).then((extent) => {\n      this.dataPolygon_ = this.createPolygonFromExtent_(extent);\n      const size = /** @type {ol.Size} */ (this.map.getSize());\n      this.map.getView().fit(extent, {size});\n      this.menuDisplayed = false;\n      this.displayExtent_();\n      this.offlineMode.enable();\n    });\n  }\n\n  /**\n   *\n   * Deactivate offline mode.\n   * Reload the page.\n   * @export\n   */\n  deactivateOfflineMode() {\n    window.location.reload();\n  }\n\n  /**\n   * Toggle the visibility of the data's extent.\n   * @export\n   */\n  toggleExtentVisibility() {\n    if (this.isExtentVisible()) {\n      this.overlayCollection_.clear();\n    } else {\n      this.displayExtent_();\n    }\n  }\n\n  /**\n   * @return {boolean} True if the extent is currently visible. False otherwise.\n   * @export\n   */\n  isExtentVisible() {\n    return this.overlayCollection_.getLength() > 0;\n  }\n\n  /**\n   * Delete the saved data.\n   * @export\n   */\n  deleteData() {\n    this.overlayCollection_.clear();\n    this.dataPolygon_ = null;\n    if (this.networkStatus.isDisconnected()) {\n      this.menuDisplayed = false;\n    }\n\n    const reloadIfInOfflineMode = () => {\n      if (this.offlineMode.isEnabled()) {\n        this.deactivateOfflineMode();\n      }\n    };\n    this.ngeoOfflineConfiguration_.clear().then(reloadIfInOfflineMode);\n  }\n\n  /**\n   * @private\n   */\n  displayExtent_() {\n    if (!this.isExtentVisible()) {\n      const feature = new olFeature(this.dataPolygon_);\n      this.overlayCollection_.push(feature);\n    }\n  }\n\n  /**\n   * When enabling mask extent, zoom the view to the defined zoom range and\n   * add constraints to the view to not allow user to move out of this range.\n   * @private\n   */\n  addZoomConstraints_() {\n    const view = this.map.getView();\n    const zoom = view.getZoom();\n\n    this.originalMinZoom = view.getMinZoom();\n    this.originalMaxZoom = view.getMaxZoom();\n\n    if (zoom < this.minZoom) {\n      view.setZoom(this.minZoom);\n    } else if (zoom > this.maxZoom) {\n      view.setZoom(this.maxZoom);\n    }\n    view.setMaxZoom(this.maxZoom);\n    view.setMinZoom(this.minZoom);\n  }\n\n  /**\n   * @private\n   */\n  removeZoomConstraints_() {\n    const view = this.map.getView();\n    view.setMaxZoom(this.originalMaxZoom);\n    view.setMinZoom(this.originalMinZoom);\n  }\n\n  /**\n   * @return {function(ol.render.Event)} Function to use as a map postcompose listener.\n   * @private\n   */\n  createMaskPostcompose_() {\n    return (evt) => {\n      const context = evt.context;\n      const frameState = evt.frameState;\n      const resolution = frameState.viewState.resolution;\n\n      const viewportWidth = frameState.size[0] * frameState.pixelRatio;\n      const viewportHeight = frameState.size[1] * frameState.pixelRatio;\n\n      const center = [viewportWidth / 2, viewportHeight / 2];\n\n      const extentLength = this.extentSize ?\n        this.extentSize / resolution * DEVICE_PIXEL_RATIO :\n        Math.min(viewportWidth, viewportHeight) - this.maskMargin * 2;\n\n      const extentHalfLength = Math.ceil(extentLength / 2);\n\n      // Draw a mask on the whole map.\n      context.beginPath();\n      context.moveTo(0, 0);\n      context.lineTo(viewportWidth, 0);\n      context.lineTo(viewportWidth, viewportHeight);\n      context.lineTo(0, viewportHeight);\n      context.lineTo(0, 0);\n      context.closePath();\n\n      // Draw the get data zone\n      const extent = this.createExtent_(center, extentHalfLength);\n\n      context.moveTo(extent[0], extent[1]);\n      context.lineTo(extent[0], extent[3]);\n      context.lineTo(extent[2], extent[3]);\n      context.lineTo(extent[2], extent[1]);\n      context.lineTo(extent[0], extent[1]);\n      context.closePath();\n\n      // Fill the mask\n      context.fillStyle = 'rgba(0, 5, 25, 0.5)';\n      context.fill();\n    };\n  }\n\n  /**\n   * A polygon on the whole extent of the projection, with a hole for the offline extent.\n   * @param {ol.Extent} extent An extent\n   * @return {ol.geom.Polygon} Polygon to save, based on the projection extent, the center of the map and\n   *     the extentSize property.\n   * @private\n   */\n  createPolygonFromExtent_(extent) {\n    const projExtent = this.map.getView().getProjection().getExtent();\n    return new olGeomPolygon([\n      extentToRectangle(projExtent),\n      extentToRectangle(extent),\n    ], olGeomGeometryLayout.XY);\n  }\n\n  /**\n   * @param {ol.Coordinate} center, a xy point.\n   * @param {number} halfLength a half length of a square's side.\n   * @return {Array.<number>} an extent.\n   * @private\n   */\n  createExtent_(center, halfLength) {\n    const minx = center[0] - halfLength;\n    const miny = center[1] - halfLength;\n    const maxx = center[0] + halfLength;\n    const maxy = center[1] + halfLength;\n    return [minx, miny, maxx, maxy];\n  }\n\n  /**\n   * @return {Array.<number>} the download extent.\n   * @private\n   */\n  getDowloadExtent_() {\n    const center = /** @type {ol.Coordinate}*/(this.map.getView().getCenter());\n    const halfLength = Math.ceil(this.extentSize || this.getExtentSize_()) / 2;\n    return this.createExtent_(center, halfLength);\n  }\n\n  getExtentSize_() {\n    const mapSize = this.map.getSize();\n    const maskSizePixel = DEVICE_PIXEL_RATIO * Math.min(mapSize[0], mapSize[1]) - this.maskMargin * 2;\n    const maskSizeMeter = maskSizePixel * this.map.getView().getResolution() / DEVICE_PIXEL_RATIO;\n    return maskSizeMeter;\n  }\n};\n\n\nexports.controller('ngeoOfflineController', exports.Controller);\n\n\nexport default exports;\n","/**\n * @module ngeo.offline.ServiceManager\n */\n\nconst exports = class {\n\n  /**\n   * @param {angular.$injector} $injector Main injector.\n   * @struct\n   * @ngInject\n   * @ngdoc service\n   * @ngname ngeoOfflineServiceManager\n   */\n  constructor($injector) {\n\n    /**\n     * @type {angular.$injector}\n     * @private\n     */\n    this.$injector_ = $injector;\n\n    /**\n     * @type {*}\n     * @private\n     */\n    this.saveService_ = null;\n\n    /**\n     * @type {*}\n     * @private\n     */\n    this.restoreService_ = null;\n  }\n\n  /**\n   * @param {string|Object} serviceLike A service like.\n   * @param {string} method A method.\n   * @return {Object} A returned object.\n   */\n  getOfflineService_(serviceLike, method) {\n    if (typeof serviceLike === 'string') {\n      if (!this.$injector_.has(serviceLike)) {\n        console.error(`The offline ${method} service could not be found`);\n        return;\n      }\n      const service = this.$injector_.get(serviceLike);\n      if (!service[method]) {\n        console.error(`The offline service ${serviceLike} does not have a ${method} method`);\n        return;\n      }\n      return service;\n    }\n    if (!serviceLike[method]) {\n      console.error(`The provided offline service does not have a ${method} method`);\n      return;\n    }\n    return serviceLike;\n  }\n\n  /**\n   * Set the service to call on 'save'.\n   * @param {string|{save: Function}} saveLikeService A service name that can be injected or an object that have a 'save' method.\n   */\n  setSaveService(saveLikeService) {\n    this.saveService_ = this.getOfflineService_(saveLikeService, 'save');\n  }\n\n  /**\n   * Set the service to call on 'restore'\n   * @param {string|{restore: Function}} restoreLikeService A service name that can be injected or an object that have a 'restore' method.\n   */\n  setRestoreService(restoreLikeService) {\n    this.restoreService_ = this.getOfflineService_(restoreLikeService, 'restore');\n  }\n\n  cancel() {\n    if (!this.saveService_) {\n      console.warn('You must register a saveService first');\n      return;\n    }\n    this.saveService_.cancel();\n  }\n\n  /**\n   * Ask the provided service to save the data to an offline purpose\n   * @param {ol.Extent} extent The extent to dowload.\n   * @param {ol.Map} map The map to work on.\n   */\n  save(extent, map) {\n    if (!this.saveService_) {\n      console.warn('You must register a saveService first');\n      return;\n    }\n    this.saveService_.save(extent, map);\n  }\n\n  /**\n   * Ask the provided service to restore the saved data on the map\n   * @param {ol.Map} map The map to work on.\n   * @return {Promise<ol.Extent>} A promise to the extent of the downloaded area\n   */\n  restore(map) {\n    if (!this.restoreService_) {\n      console.warn('You must register a restoreService first');\n      return Promise.reject();\n    }\n    return this.restoreService_.restore(map);\n  }\n};\n\n/**\n * @type {!angular.Module}\n */\nexports.module = angular.module('ngeoOfflineServiceManager', []);\nexports.module.service('ngeoOfflineServiceManager', exports);\n\n\nexport default exports;\n","/**\n * @module ngeo.offline.TilesDownloader\n */\nimport googAsserts from 'goog/asserts.js';\n\n\n/**\n * @param {!Blob} blob A blob\n * @return {Promise<string>} data URL\n */\nfunction blobToDataUrl(blob) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = function() {\n      resolve(reader.result);\n    };\n    reader.onerror = reject;\n    reader.readAsDataURL(blob);\n  });\n}\n\nconst exports = class {\n\n  /**\n   * @param {Array<ngeox.OfflineTile>} tiles An array of tiles to download.\n   * @param {ngeox.OfflineOnTileDownload} callbacks The callbacks.\n   * @param {number} workers The maximum number of workers.\n   */\n  constructor(tiles, callbacks, workers) {\n    /**\n     * @private\n     * @type {number}\n     */\n    this.maxNumberOfWorkers_ = workers;\n\n    /**\n     * @private\n     */\n    this.wasStarted_ = false;\n\n    /**\n     * @type {Array<ngeox.OfflineTile>}\n     * @private\n     */\n    this.tiles_ = tiles;\n\n    /**\n     * @private\n     * @type {ngeox.OfflineOnTileDownload}\n     */\n    this.callbacks_ = callbacks;\n\n    /**\n     * @private\n     */\n    this.allCount_ = 0;\n\n    /**\n     * @private\n     */\n    this.okCount_ = 0;\n\n    /**\n     * @private\n     */\n    this.koCount_ = 0;\n\n    /**\n     * @private\n     */\n    this.requestedCount_ = 0;\n\n    /**\n     * @private\n     * @type {function()}\n     */\n    this.resolvePromise_;\n\n    /**\n     * @private\n     * @type {Promise}\n     */\n    this.promise_ = null;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.tileIndex_ = 0;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.cancel_ = false;\n  }\n\n  cancel() {\n    this.cancel_ = true;\n  }\n\n  /**\n   * @private to download.\n   */\n  downloadTile_() {\n    if (this.cancel_ || this.tileIndex_ >= this.tiles_.length) {\n      return;\n    }\n    const tile = this.tiles_[this.tileIndex_++];\n    const tileUrl = tile.url;\n    const xhr = new XMLHttpRequest();\n    xhr.tileUrl = tile.url;\n    xhr.open('GET', tileUrl, true);\n    xhr.responseType = 'blob';\n    const onTileDownloaded = () => {\n      if (this.allCount_ === this.tiles_.length) {\n        this.resolvePromise_();\n      }\n      this.downloadTile_();\n    };\n\n    const errorCallback = (e) => {\n      if (this.cancel_) {\n        return;\n      }\n      ++this.allCount_;\n      ++this.koCount_;\n      const progress = this.allCount_ / this.tiles_.length;\n      this.callbacks_.onTileDownloadError(progress).then(onTileDownloaded, onTileDownloaded);\n    };\n\n    const onloadCallback = (e) => {\n      /**\n       * @type {Blob}\n       */\n      const response = e.target.response;\n      if (response && response.size !== 0) { // non-empty tile\n        blobToDataUrl(response).then(\n          (dataUrl) => {\n            if (this.cancel_) {\n              return;\n            }\n            ++this.allCount_;\n            ++this.okCount_;\n            tile.response = dataUrl;\n            const progress = this.allCount_ / this.tiles_.length;\n            this.callbacks_.onTileDownloadSuccess(progress, tile).then(onTileDownloaded, onTileDownloaded);\n          },\n          () => {\n            if (this.cancel_) {\n              return;\n            }\n            errorCallback(e);\n          }\n        );\n      } else {\n        if (this.cancel_) {\n          return;\n        }\n        ++this.allCount_;\n        ++this.okCount_;\n        this.callbacks_.onTileDownloadSuccess(this.allCount_ / this.tiles_.length, tile).then(onTileDownloaded, onTileDownloaded);\n      }\n    };\n\n    xhr.onload = onloadCallback;\n    xhr.onerror = errorCallback;\n    xhr.onabort = errorCallback;\n    xhr.ontimeout = errorCallback;\n    xhr.send();\n    ++this.requestedCount_;\n  }\n\n  /**\n   * @return {Promise} A promise that resolves when the downloads are complete (failing or not)\n   */\n  download() {\n    if (this.promise_) {\n      return this.promise_;\n    }\n\n    this.promise_ = new Promise((resolve, reject) => {\n      this.resolvePromise_ = resolve;\n    });\n\n    googAsserts.assert(this.tiles_);\n    if (this.tiles_.length === 0) {\n      this.callbacks_.onTileDownloadError(1); // forcing progress update\n      this.resolvePromise_();\n    } else {\n      for (let i = 0; i < this.maxNumberOfWorkers_; ++i) {\n        this.downloadTile_();\n      }\n    }\n\n    return this.promise_;\n  }\n};\n\n\nexport default exports;\n","/**\n * @module ngeo.offline.Downloader\n */\nimport {DEVICE_PIXEL_RATIO} from 'ol/has.js';\nimport googAsserts from 'goog/asserts.js';\nimport olSourceTileWMS from 'ol/source/TileWMS.js';\nimport olSourceWMTS from 'ol/source/WMTS.js';\nimport TilesDownloader from 'ngeo/offline/TilesDownloader.js';\n\n\n/**\n * @param {ol.Coordinate} a Some coordinates.\n * @param {ol.Coordinate} b Some other coordinates.\n * @return {number} The squared magnitude.\n */\nfunction magnitude2(a, b) {\n  let magnitudeSquared = 0;\n  for (let i = 0; i < a.length; ++i) {\n    magnitudeSquared += Math.pow(a[1] - b[1], 2);\n  }\n  return magnitudeSquared;\n}\n\n\nconst Downloader = class {\n\n  /**\n   * @ngInject\n   * @param {ngeo.offline.Configuration} ngeoOfflineConfiguration A service for customizing offline behaviour.\n   */\n  constructor(ngeoOfflineConfiguration) {\n    /**\n     * @private\n     * @type {ngeo.offline.Configuration}\n     */\n    this.configuration_ = ngeoOfflineConfiguration;\n\n    /**\n     * @type {TilesDownloader}\n     * @private\n     */\n    this.tileDownloader_ = null;\n  }\n\n  cancel() {\n    this.tileDownloader_.cancel();\n  }\n\n  /**\n   * @param {ngeox.OfflineLayerMetadata} layerMetadata Layers metadata.\n   * @param {Array<ngeox.OfflineTile>} queue Queue of tiles to download.\n   */\n  queueLayerTiles_(layerMetadata, queue) {\n    const {map, source, extentByZoom} = layerMetadata;\n\n    if (!source) {\n      return;\n    }\n    googAsserts.assert(source instanceof olSourceTileWMS || source instanceof olSourceWMTS);\n    const projection = map.getView().getProjection();\n    const tileGrid = source.getTileGrid();\n    const tileUrlFunction = source.getTileUrlFunction();\n\n    googAsserts.assert(extentByZoom);\n    for (const extentZoom of extentByZoom) {\n      const z = extentZoom.zoom;\n      const extent = extentZoom.extent;\n      const queueByZ = [];\n      let minX, minY, maxX, maxY;\n      tileGrid.forEachTileCoord(extent, z, (coord) => {\n        maxX = coord[1];\n        maxY = coord[2];\n        if (minX === undefined) {\n          minX = coord[1];\n          minY = coord[2];\n        }\n        const url = tileUrlFunction(coord, DEVICE_PIXEL_RATIO, projection);\n        googAsserts.assert(url);\n\n        /**\n         * @type {ngeox.OfflineTile}\n         */\n        const tile = {coord, url};\n        queueByZ.push(tile);\n      });\n\n      const centerTileCoord = [z, (minX + maxX) / 2, (minY + maxY) / 2];\n      queueByZ.sort((a, b) => magnitude2(a.coord, centerTileCoord) - magnitude2(b.coord, centerTileCoord));\n      queue.push(...queueByZ);\n    }\n  }\n\n  /**\n   * @param {ol.Extent} extent The extent to download.\n   * @param {ol.Map} map The map to work on.\n   * @return {Promise} A promise resolving when save is finished.\n   */\n  save(extent, map) {\n    /**\n     * @type {!Array<ngeox.OfflineLayerMetadata>}\n     */\n    const layersMetadatas = this.configuration_.createLayerMetadatas(map, extent);\n\n    /**\n     * @type {!Array<ngeox.OfflinePersistentLayer>}\n     */\n    const persistentLayers = [];\n    const queue = [];\n    const zooms = [];\n    for (const layerItem of layersMetadatas) {\n      if (layerItem.layerType === 'tile') {\n        const tiles = [];\n        this.queueLayerTiles_(layerItem, tiles);\n        queue.push(...tiles);\n      }\n      persistentLayers.push({\n        backgroundLayer: layerItem.backgroundLayer,\n        layerType: layerItem.layerType,\n        layerSerialization: layerItem.layerSerialization,\n        key: this.configuration_.getLayerKey(layerItem),\n      });\n\n      layerItem.extentByZoom.forEach((obj) => {\n        const zoom = obj.zoom;\n        if (zooms.indexOf(zoom) < 0) {\n          zooms.push(zoom);\n        }\n      });\n    }\n\n    /**\n     * @type {ngeox.OfflinePersistentContent}\n     */\n    const persistentObject = {\n      extent: extent,\n      layers: persistentLayers,\n      zooms: zooms.sort((a, b) => (a < b ? -1 : 1))\n    };\n    const setOfflineContentPromise = this.configuration_.setItem('offline_content', persistentObject);\n\n    this.tileDownloader_ = new TilesDownloader(queue, this.configuration_, this.configuration_.getMaxNumberOfParallelDownloads());\n    const tileDownloadPromise = this.tileDownloader_.download();\n\n    const allPromise = Promise.all([setOfflineContentPromise, tileDownloadPromise]);\n    const setHasOfflineData = () => this.configuration_.setHasOfflineData(true);\n    allPromise.then(setHasOfflineData, setHasOfflineData);\n    return allPromise;\n  }\n};\n\nconst name = 'offlineDownloader';\nDownloader.module = angular.module(name, []).service(name, Downloader);\n\nconst exports = Downloader;\n\n\nexport default exports;\n","/**\n * @module ngeo.offline.Restorer\n */\nimport ngeoMapBackgroundLayerMgr from 'ngeo/map/BackgroundLayerMgr.js';\n\n\nclass Restorer {\n\n  /**\n   * @ngInject\n   * @param {ngeo.offline.Configuration} ngeoOfflineConfiguration A service for customizing offline behaviour.\n   * @param {ngeo.map.BackgroundLayerMgr} ngeoBackgroundLayerMgr The background layer manager.\n   */\n  constructor(ngeoOfflineConfiguration, ngeoBackgroundLayerMgr) {\n    /**\n     * @private\n     * @type {ngeo.offline.Configuration}\n     */\n    this.configuration_ = ngeoOfflineConfiguration;\n\n    /**\n     * @private\n     * @type {ngeo.map.BackgroundLayerMgr}\n     */\n    this.ngeoBackgroundLayerMgr_ = ngeoBackgroundLayerMgr;\n  }\n\n  /**\n   * @param {ol.Map} map The map to work on.\n   * @return {Promise<ol.Extent>} A promise to the extent of the restored area.\n   */\n  restore(map) {\n    return this.configuration_.getItem('offline_content').then(offlineContent => this.doRestore(map, offlineContent));\n  }\n\n  /**\n   * @protected\n   * @param {ol.Map} map A map\n   * @param {ngeox.OfflinePersistentContent} offlineContent The offline content\n   * @return {ol.Extent} The extent of the restored area\n   */\n  doRestore(map, offlineContent) {\n    map.getLayerGroup().getLayers().clear();\n    for (const offlineLayer of offlineContent.layers) {\n      const layer = this.configuration_.recreateOfflineLayer(offlineLayer);\n      if (layer) {\n        map.addLayer(layer);\n        if (offlineLayer.backgroundLayer) {\n          this.ngeoBackgroundLayerMgr_.set(map, layer);\n        }\n      }\n    }\n    return offlineContent.extent;\n  }\n}\n\nconst name = 'ngeoOfflineRestorer';\nRestorer.module = angular.module(name, [\n  ngeoMapBackgroundLayerMgr.module.name\n]).service(name, Restorer);\n\nconst exports = Restorer;\n\n\nexport default exports;\n","/**\n * @module ngeo.offline.Mode\n */\n\nconst exports = class {\n\n  /**\n   * @param {ngeo.offline.Configuration} ngeoOfflineConfiguration ngeo offline configuration service.\n   * @ngInject\n   * @ngdoc service\n   * @ngname ngeoOfflineState\n   */\n  constructor(ngeoOfflineConfiguration) {\n\n    /**\n     * Offline mode is enabled or not.\n     * @type {boolean}\n     * @private\n     */\n    this.enabled_ = false;\n\n    /**\n     * Offline component.\n     * @type {ngeo.offline.component.Controller|undefined}\n     * @private\n     */\n    this.component_;\n\n    /**\n     * @private\n     * @type {ngeo.offline.Configuration}\n     */\n    this.ngeoOfflineConfiguration_ = ngeoOfflineConfiguration;\n  }\n\n  /**\n   * Return if we are in offline mode.\n   * @return {boolean} whether offline mode is enabled\n   * @export\n   */\n  isEnabled() {\n    return this.enabled_;\n  }\n\n  /**\n   * Enable offline mode. ATM we cannot escape from the offline mode.\n   * @export\n   */\n  enable() {\n    this.enabled_ = true;\n  }\n\n  /**\n   *\n   * @param {ngeo.offline.component.Controller} component Offline component.\n   * @export\n   */\n  registerComponent(component) {\n    this.component_ = component;\n  }\n\n  /**\n   * @export\n   */\n  activateOfflineMode() {\n    this.component_.activateOfflineMode();\n  }\n\n  /**\n   * @return {boolean} True if data are accessible offline.\n   * @export\n   */\n  hasData() {\n    return this.ngeoOfflineConfiguration_.hasOfflineData();\n  }\n\n};\n\n/**\n * @type {!angular.Module}\n */\nexports.module = angular.module('ngeoOfflineMode', []);\nexports.module.service('ngeoOfflineMode', exports);\n\n\nexport default exports;\n","/**\n * @module ngeo.offline.module\n */\nimport ngeoOfflineComponent from 'ngeo/offline/component.js';\nimport ngeoOfflineNetworkStatus from 'ngeo/offline/NetworkStatus.js';\nimport ngeoOfflineServiceManager from 'ngeo/offline/ServiceManager.js';\nimport downloader from 'ngeo/offline/Downloader.js';\nimport restorer from 'ngeo/offline/Restorer.js';\nimport mode from 'ngeo/offline/Mode.js';\n\n/**\n * @type {!angular.Module}\n */\nconst exports = angular.module('ngeoOfflineModule', [\n  ngeoOfflineComponent.name,\n  ngeoOfflineNetworkStatus.module.name,\n  ngeoOfflineServiceManager.module.name,\n  downloader.module.name,\n  restorer.module.name,\n  mode.module.name\n]);\n\nexports.value('ngeoOfflineGutter', 96);\n\n\nexport default exports;\n","/**\n * @module ngeo.offline.SerializerDeserializer\n */\nimport olTilegridTileGrid from 'ol/tilegrid/TileGrid.js';\nimport olTilegridWMTS from 'ol/tilegrid/WMTS.js';\nimport * as olProj from 'ol/proj.js';\nimport olSourceTileWMS from 'ol/source/TileWMS.js';\nimport olSourceWMTS from 'ol/source/WMTS.js';\nimport olLayerTile from 'ol/layer/Tile.js';\n\n\nconst SerDes = class {\n  /**\n   * @param {Object} options The options\n   */\n  constructor({gutter}) {\n    /**\n     * @private\n     */\n    this.gutter_ = gutter;\n  }\n\n  /**\n   * @private\n   * @param {ol.Object} olObject An OL object\n   * @return {Object} The serializable properties of the object\n   */\n  createBaseObject_(olObject) {\n    const properties = olObject.getProperties();\n    const obj = {};\n    for (const key in properties) {\n      const value = properties[key];\n      const typeOf = typeof value;\n      if (typeOf === 'string' || typeOf === 'number') {\n        obj[key] = value;\n      }\n    }\n    return obj;\n  }\n\n  /**\n   * @param {ol.tilegrid.TileGrid} tilegrid .\n   * @return {string} .\n   */\n  serializeTilegrid(tilegrid) {\n    const obj = {};\n    obj['extent'] = tilegrid.getExtent();\n    obj['minZoom'] = tilegrid.getMinZoom();\n    obj['origin'] = tilegrid.getOrigin(0); // hack\n    obj['resolutions'] = tilegrid.getResolutions();\n    obj['tileSize'] = tilegrid.getTileSize(tilegrid.getMinZoom());\n    return JSON.stringify(obj);\n  }\n\n  /**\n   * @param {string} serialization .\n   * @return {ol.tilegrid.TileGrid} tilegrid\n   */\n  deserializeTilegrid(serialization) {\n    const options = /** @type {olx.tilegrid.TileGridOptions} */ (JSON.parse(serialization));\n    return new olTilegridTileGrid(options);\n  }\n\n  /**\n   * @param {ol.tilegrid.WMTS} tilegrid .\n   * @return {string|undefined} .\n   */\n  serializeTilegridWMTS(tilegrid) {\n    if (!tilegrid) {\n      return undefined;\n    }\n    const obj = {};\n    const resolutions = tilegrid.getResolutions();\n    obj['extent'] = tilegrid.getExtent();\n    obj['minZoom'] = tilegrid.getMinZoom();\n    obj['matrixIds'] = tilegrid.getMatrixIds();\n    obj['resolutions'] = resolutions;\n\n    obj['origins'] = [];\n    for (let z = 0; z < resolutions.length; ++z) {\n      obj['origins'].push(tilegrid.getOrigin(z));\n    }\n    return JSON.stringify(obj);\n  }\n\n  /**\n   * @param {string} serialization .\n   * @return {ol.tilegrid.WMTS} tilegrid .\n   */\n  deserializeTilegridWMTS(serialization) {\n    const options = /** @type {olx.tilegrid.WMTSOptions} */ (JSON.parse(serialization));\n    return new olTilegridWMTS(options);\n  }\n\n\n  /**\n   * @param {ol.source.TileWMS} source .\n   * @return {string} .\n   */\n  serializeSourceTileWMS(source) {\n    const obj = this.createBaseObject_(source);\n    obj['params'] = source.getParams();\n    obj['urls'] = source.getUrls();\n    obj['tileGrid'] = this.serializeTilegrid(source.getTileGrid());\n    const projection = source.getProjection();\n    if (projection) {\n      obj['projection'] = olProj.get(source.getProjection()).getCode();\n    }\n\n    return JSON.stringify(obj);\n  }\n\n  /**\n   * @param {string} serialization .\n   * @param {function(ol.ImageTile, string)=} tileLoadFunction .\n   * @return {ol.source.TileWMS} source .\n   */\n  deserializeSourceTileWMS(serialization, tileLoadFunction) {\n    const options = /** @type {olx.source.TileWMSOptions} */ (JSON.parse(serialization));\n    options['tileLoadFunction'] = tileLoadFunction;\n    if (options['tileGrid']) {\n      options['tileGrid'] = this.deserializeTilegrid(options['tileGrid']);\n    }\n    options['gutter'] = this.gutter_;\n    return new olSourceTileWMS(options);\n  }\n\n  /**\n   * @param {ol.source.WMTS} source .\n   * @return {string} .\n   */\n  serializeSourceWMTS(source) {\n    const obj = this.createBaseObject_(source);\n    obj['dimensions'] = source.getDimensions();\n    obj['format'] = source.getFormat();\n    obj['urls'] = source.getUrls();\n    obj['version'] = source.getVersion();\n    obj['layer'] = source.getLayer();\n    obj['style'] = source.getStyle();\n    obj['matrixSet'] = source.getMatrixSet();\n    // The OL getTileGrid method is expected to return a WMTS tilegrid so it is OK to cast here.\n    const tileGridWMTS = /** @type {ol.tilegrid.WMTS} */ (source.getTileGrid());\n    obj['tileGrid'] = this.serializeTilegridWMTS(tileGridWMTS);\n    obj['requestEncoding'] = source.getRequestEncoding();\n    const projection = source.getProjection();\n    if (projection) {\n      obj['projection'] = olProj.get(source.getProjection()).getCode();\n    }\n\n    return JSON.stringify(obj);\n  }\n\n  /**\n   * @param {string} serialization .\n   * @param {function(ol.ImageTile, string)=} tileLoadFunction .\n   * @return {ol.source.WMTS} .\n   */\n  deserializeSourceWMTS(serialization, tileLoadFunction) {\n    const options = /** @type {olx.source.WMTSOptions} */ (JSON.parse(serialization));\n    options['tileLoadFunction'] = tileLoadFunction;\n    if (options['tileGrid']) {\n      options['tileGrid'] = this.deserializeTilegridWMTS(options['tileGrid']);\n    }\n    return new olSourceWMTS(options);\n  }\n\n  /**\n   * @private\n   * @param {number} number Some number which may be Infinity\n   * @return {number} The same number or an arbitrary big number instead of Infinity\n   */\n  makeInfinitySerializable_(number) {\n    if (number === Infinity) {\n      return 1000;\n    }\n    return number;\n  }\n\n  /**\n   * @param {ol.layer.Tile|ol.layer.Image} layer .\n   * @param {ol.source.Source=} source .\n   * @return {string} .\n   */\n  serializeTileLayer(layer, source) {\n    const obj = this.createBaseObject_(layer);\n    obj['opacity'] = layer.getOpacity();\n    obj['visible'] = layer.getVisible();\n    obj['minResolution'] = layer.getMinResolution();\n    obj['maxResolution'] = this.makeInfinitySerializable_(layer.getMaxResolution());\n    obj['zIndex'] = layer.getZIndex();\n    source = source || layer.getSource();\n    if (source instanceof olSourceTileWMS) {\n      obj['source'] = this.serializeSourceTileWMS(source);\n      obj['sourceType'] = 'tileWMS';\n    } else if (source instanceof olSourceWMTS) {\n      obj['source'] = this.serializeSourceWMTS(source);\n      obj['sourceType'] = 'WMTS';\n    }\n    return JSON.stringify(obj);\n  }\n\n  /**\n   * @param {string} serialization .\n   * @param {function(ol.ImageTile, string)=} tileLoadFunction .\n   * @return {ol.layer.Tile} .\n   */\n  deserializeTileLayer(serialization, tileLoadFunction) {\n    const options = /** @type {olx.layer.TileOptions} */ (JSON.parse(serialization));\n    const sourceType = options['sourceType'];\n    if (sourceType === 'tileWMS') {\n      options['source'] = this.deserializeSourceTileWMS(options['source'], tileLoadFunction);\n    } else if (sourceType === 'WMTS') {\n      options['source'] = this.deserializeSourceWMTS(options['source'], tileLoadFunction);\n    }\n    return new olLayerTile(options);\n  }\n};\n\nconst exports = SerDes;\n\n\nexport default exports;\n","/**\n * @module ngeo.offline.AbstractLocalforageWrapper\n */\n/**\n * @typedef {{\n *   id: number,\n *   plugin: string,\n *   command: string,\n *   args: !Array<*>,\n *   context: (*|undefined)\n * }}\n */\n// eslint-disable-next-line no-unused-vars\nlet Action;\n\n/**\n * @abstract\n */\nconst exports = class AbstractLocalforageWrapper {\n  constructor() {\n    this.waitingPromises_ = new window.Map();\n    this.currentId_ = 0;\n  }\n\n  setItem(...args) {\n    return this.createAction('setItem', ...args);\n  }\n\n  getItem(...args) {\n    return this.createAction('getItem', ...args);\n  }\n\n  clear() {\n    return this.createAction('clear');\n  }\n\n  config(...args) {\n    return this.createAction('config', ...args);\n  }\n\n  /**\n   * @export\n   * @param {string} command .\n   * @param  {...*} args .\n   * @return {Promise} .\n   */\n  createAction(command, ...args) {\n    const id = ++this.currentId_;\n    /**\n     * @type {Action}\n     */\n    const action = {\n      'plugin': 'localforage',\n      'command': command,\n      'args': args,\n      'id': id\n    };\n    console.log('sending action', JSON.stringify(action, null, '\\t'));\n    const waitingPromise = {};\n    const promise = new Promise((resolve, reject) => {\n      waitingPromise['resolve'] = resolve;\n      waitingPromise['reject'] = reject;\n    });\n    this.waitingPromises_.set(id, waitingPromise);\n    this.postToBackend(action);\n    return promise;\n  }\n\n  /**\n   * @export\n   * @param {*} event .\n   */\n  receiveMessage(event) {\n    /**\n     * @type {Action}\n     */\n    const action = event['data'];\n    const id = action['id'];\n    const command = action['command'];\n    const args = action['args'] || [];\n    const context = action['context'];\n    const msg = action['msg'];\n    console.log('received action', JSON.stringify(action, null, '\\t'));\n\n    const waitingPromise = this.waitingPromises_.get(id);\n    if (command === 'error') {\n      console.error(msg, args, context);\n      if (waitingPromise) {\n        waitingPromise.reject(args, context);\n        this.waitingPromises_.delete(id);\n      }\n    } else if (command === 'response') {\n      console.log('Received response message from backend');\n      waitingPromise.resolve(...args);\n      this.waitingPromises_.delete(id);\n    } else {\n      console.error('Unhandled command', JSON.stringify(action, null, '\\t'));\n    }\n  }\n\n  /**\n   * @abstract\n   * @protected\n   * @param {Action} action .\n   */\n  postToBackend(action) {\n  }\n};\n\n\nexport default exports;\n","/**\n * @module ngeo.offline.LocalforageCordovaWrapper\n */\nimport AbstractWrapper from 'ngeo/offline/AbstractLocalforageWrapper.js';\n\nconst exports = class CordovaWrapper extends AbstractWrapper {\n  constructor() {\n    super();\n    window.addEventListener('message', this.receiveMessage.bind(this), false);\n  }\n\n  /**\n   * @override\n   */\n  postToBackend(action) {\n    window['parent'].postMessage(action, '*');\n  }\n};\n\n\nexport default exports;\n","/**\n * @module ngeo.offline.LocalforageAndroidWrapper\n */\nimport AbstractWrapper from 'ngeo/offline/AbstractLocalforageWrapper.js';\n\nconst exports = class AndroidWrapper extends AbstractWrapper {\n  constructor() {\n    super();\n    window['androidWrapper'] = this;\n  }\n\n  /**\n   * @override\n   */\n  postToBackend(action) {\n    const stringified = JSON.stringify(action);\n    window['ngeoHost']['postMessageToAndroid'](stringified);\n  }\n\n  /**\n   * @export\n   * @param {string} actionString .\n   */\n  receiveFromAndroid(actionString) {\n    const action = JSON.parse(actionString);\n    this.receiveMessage({\n      'data': action\n    });\n  }\n};\n\n\nexport default exports;\n","/**\n * @module ngeo.offline.LocalforageIosWrapper\n */\nimport AbstractWrapper from 'ngeo/offline/AbstractLocalforageWrapper.js';\n\nconst exports = class IosWrapper extends AbstractWrapper {\n  constructor() {\n    super();\n    window['iosWrapper'] = this;\n  }\n\n  /**\n   * @override\n   */\n  postToBackend(action) {\n    if (action['command'] === 'setItem')  {\n      action['args'][1] = JSON.stringify(action['args'][1]);\n    }\n    const stringified = JSON.stringify(action);\n    window['webkit']['messageHandlers']['ios']['postMessage'](stringified);\n  }\n\n  /**\n   * @export\n   * @param {string} actionString .\n   */\n  receiveFromIos(actionString) {\n    const action = JSON.parse(actionString);\n    action['args'] = (action['args'] || []).map(item => JSON.parse(item));\n    this.receiveMessage({\n      'data': action\n    });\n  }\n};\n\n\nexport default exports;\n","/**\n * @module ngeo.offline.utils\n */\nconst exports = {};\nimport olLayerGroup from 'ol/layer/Group.js';\n\n\n/**\n * @param {ol.layer.Base} layer A layer tree.\n * @param {!Array<ol.layer.Group>} ancestors The groups to which the layer belongs to.\n * @param {function(ol.layer.Base, Array<ol.layer.Group>): boolean} visitor A function which will return false if descend must stop.\n */\nexports.traverseLayer = function(layer, ancestors, visitor) {\n  const descend = visitor(layer, ancestors);\n  if (descend && layer instanceof olLayerGroup) {\n    layer.getLayers().forEach((childLayer) => {\n      exports.traverseLayer(childLayer, [...ancestors, layer], visitor);\n    });\n  }\n};\n\nconst extractor = new RegExp('[^/]*//[^/]+/(.*)');\n/**\n * Extract the part after the URL authority.\n * @param {string} url A URL to normalize\n * @return {string} The normalized string.\n */\nexports.normalizeURL = function(url) {\n  const matches = url.match(extractor);\n  return matches[1];\n};\n\n\nexport default exports;\n","/**\n * @module ngeo.offline.Configuration\n */\nimport olObservable from 'ol/Observable.js';\nimport olLayerLayer from 'ol/layer/Layer.js';\nimport olLayerVector from 'ol/layer/Vector.js';\nimport olLayerTile from 'ol/layer/Tile.js';\nimport olLayerImage from 'ol/layer/Image.js';\nimport * as olProj from 'ol/proj.js';\nimport olSourceImage from 'ol/source/Image.js';\nimport olSourceImageWMS from 'ol/source/ImageWMS.js';\nimport olSourceTileWMS from 'ol/source/TileWMS.js';\nimport {createForProjection as createTileGridForProjection} from 'ol/tilegrid.js';\nimport SerializerDeserializer from 'ngeo/offline/SerializerDeserializer.js';\nimport LocalforageCordovaWrapper from 'ngeo/offline/LocalforageCordovaWrapper.js';\nimport LocalforageAndroidWrapper from 'ngeo/offline/LocalforageAndroidWrapper.js';\nimport LocalforageIosWrapper from 'ngeo/offline/LocalforageIosWrapper.js';\nimport ngeoCustomEvent from 'ngeo/CustomEvent.js';\nimport utils from 'ngeo/offline/utils.js';\nconst defaultImageLoadFunction = olSourceImage.defaultImageLoadFunction;\n\nimport * as realLocalforage from 'localforage';\n\n/**\n * @implements {ngeox.OfflineOnTileDownload}\n */\nconst exports = class extends olObservable {\n\n  /**\n   * @ngInject\n   * @param {!angular.Scope} $rootScope The rootScope provider.\n   * @param {ngeo.map.BackgroundLayerMgr} ngeoBackgroundLayerMgr The background layer manager\n   * @param {number} ngeoOfflineGutter A gutter around the tiles to download (to avoid cut symbols)\n   */\n  constructor($rootScope, ngeoBackgroundLayerMgr, ngeoOfflineGutter) {\n    super();\n\n    this.localforage_ = this.createLocalforage();\n    this.configureLocalforage();\n\n    /**\n     * @private\n     * @type {!angular.Scope}\n     */\n    this.rootScope_ = $rootScope;\n\n    /**\n     * @protected\n     * @type {boolean}\n     */\n    this.hasData = false;\n    this.initializeHasOfflineData();\n\n    /**\n     * @private\n     * @type {ngeo.map.BackgroundLayerMgr}\n     */\n    this.ngeoBackgroundLayerMgr_ = ngeoBackgroundLayerMgr;\n\n    /**\n     * @private\n     * @type {ngeo.offline.SerializerDeserializer}\n     */\n    this.serDes_ = new SerializerDeserializer({gutter: ngeoOfflineGutter});\n\n    /**\n     * @private\n     * @type {number}\n     */\n    this.gutter_ = ngeoOfflineGutter;\n  }\n\n  /**\n   * @private\n   * @param {number} progress new progress.\n   */\n  dispatchProgress_(progress) {\n    this.dispatchEvent(new ngeoCustomEvent('progress', {\n      'progress': progress\n    }));\n  }\n\n  /**\n   * @protected\n   */\n  initializeHasOfflineData() {\n    this.getItem('offline_content').then(value => this.setHasOfflineData(!!value));\n  }\n\n  /**\n   * @export\n   * @return {boolean} whether some offline data is available in the storage\n   */\n  hasOfflineData() {\n    return this.hasData;\n  }\n\n  /**\n   * @param {boolean} value whether there is offline data available in the storage.\n   */\n  setHasOfflineData(value) {\n    const needDigest = value ^ this.hasData;\n    this.hasData = value;\n    if (needDigest) {\n      this.rootScope_.$applyAsync(); // force update of the UI\n    }\n  }\n\n  /**\n   * Hook to allow measuring get/set item performance.\n   * @param {string} msg A message\n   * @param {string} key The key to work on\n   * @param {Promise<?>} promise A promise\n   * @return {Promise<?>} The promise we passed\n   */\n  traceGetSetItem(msg, key, promise) {\n    return promise;\n  }\n\n  createLocalforage() {\n    if (location.search.includes('localforage=cordova')) {\n      console.log('Using cordova localforage');\n      return new LocalforageCordovaWrapper();\n    } else if (location.search.includes('localforage=android')) {\n      console.log('Using android localforage');\n      return new LocalforageAndroidWrapper();\n    } else if (location.search.includes('localforage=ios')) {\n      console.log('Using ios localforage');\n      return new LocalforageIosWrapper();\n    }\n    return realLocalforage;\n  }\n\n  configureLocalforage() {\n    this.localforage_.config({\n      'name': 'ngeoOfflineStorage',\n      'version': 1.0,\n      'storeName': 'offlineStorage'\n    });\n  }\n\n  /**\n   * @param {string} key The key\n   * @return {Promise<?>} A promise\n   */\n  getItem(key) {\n    return this.traceGetSetItem('getItem', key, this.localforage_.getItem(key));\n  }\n\n  /**\n   * @param {string} key .\n   * @return {Promise<?>} .\n   */\n  removeItem(key) {\n    return this.traceGetSetItem('removeItem', key, this.localforage_.removeItem(key));\n  }\n\n  /**\n   * @param {string} key The key\n   * @param {*} value A value\n   * @return {Promise<?>} A promise\n   */\n  setItem(key, value) {\n    return this.traceGetSetItem('setItem', key, this.localforage_.setItem(key, value));\n  }\n\n  /**\n   * @return {Promise} A promise\n   */\n  clear() {\n    this.setHasOfflineData(false);\n    return this.traceGetSetItem('clear', '', this.localforage_.clear());\n  }\n\n  /**\n   * @param {!ol.Map} map A map\n   * @return {number} An \"estimation\" of the size of the data to download\n   */\n  estimateLoadDataSize(map) {\n    return 50;\n  }\n\n  /**\n   * @param {ngeox.OfflineLayerMetadata} layerItem The layer metadata\n   * @return {string} A key identifying an offline layer and used during restore.\n   */\n  getLayerKey(layerItem) {\n    return /** @type {string} */ (layerItem.layer.get('label'));\n  }\n\n  /**\n   * @override\n   * @param {number} progress The download progress\n   * @param {ngeox.OfflineTile} tile The tile\n   * @return {Promise} A promise\n   */\n  onTileDownloadSuccess(progress, tile) {\n    this.dispatchProgress_(progress);\n\n    if (tile.response) {\n      return this.setItem(utils.normalizeURL(tile.url), tile.response);\n    }\n    return Promise.resolve();\n  }\n\n  /**\n   * @override\n   * @param {number} progress The progress\n   * @return {Promise} A promise\n   */\n  onTileDownloadError(progress) {\n    this.dispatchProgress_(progress);\n    return Promise.resolve();\n  }\n\n  /**\n    * @param {ol.Map} map A map\n    * @param {ol.layer.Layer} layer A layer\n    * @param {Array<ol.layer.Group>} ancestors The ancestors of that layer\n    * @param {ol.Extent} userExtent The extent selected by the user.\n    * @return {Array<ngeox.OfflineExtentByZoom>} The extent to download per zoom level\n   */\n  getExtentByZoom(map, layer, ancestors, userExtent) {\n    const currentZoom = map.getView().getZoom();\n    // const viewportExtent = map.calculateExtent(map.getSize());\n\n    const results = [];\n    [0, 1, 2, 3, 4].forEach((dz) => {\n      results.push({\n        zoom: currentZoom + dz,\n        extent: userExtent\n      });\n    });\n    return results;\n  }\n\n  /**\n   * @protected\n   * @param {ol.source.Source} source An ImageWMS source\n   * @param {ol.proj.Projection} projection The projection\n   * @return {ol.source.Source} A tiled equivalent source\n   */\n  sourceImageWMSToTileWMS(source, projection) {\n    if (source instanceof olSourceImageWMS && source.getUrl() && source.getImageLoadFunction() === defaultImageLoadFunction) {\n      const tileGrid = createTileGridForProjection(source.getProjection() || projection, 42, 256);\n      source = new olSourceTileWMS({\n        gutter: this.gutter_,\n        url: source.getUrl(),\n        tileGrid: tileGrid,\n        attributions: source.getAttributions(),\n        projection: source.getProjection(),\n        params: source.getParams()\n      });\n    }\n    return source;\n  }\n\n  /**\n   * @param {ol.Map} map The map to work on.\n   * @param {ol.Extent} userExtent The extent selected by the user.\n   * @return {!Array<ngeox.OfflineLayerMetadata>} the downloadable layers and metadata.\n   */\n  createLayerMetadatas(map, userExtent) {\n    const layersItems = [];\n\n    /**\n     * @param {ol.layer.Base} layer .\n     * @param {Array<ol.layer.Group>} ancestors .\n     * @return {boolean} whether to traverse this layer children.\n     */\n    const visitLayer = (layer, ancestors) => {\n      if (layer instanceof olLayerLayer) {\n        const extentByZoom = this.getExtentByZoom(map, layer, ancestors, userExtent);\n        const projection = olProj.get(map.getView().getProjection());\n        const source = this.sourceImageWMSToTileWMS(layer.getSource(), projection);\n        let layerType;\n        let layerSerialization;\n        if (layer instanceof olLayerTile || layer instanceof olLayerImage) {\n          layerType = 'tile';\n          layerSerialization = this.serDes_.serializeTileLayer(layer, source);\n        } else if (layer instanceof olLayerVector) {\n          layerType = 'vector';\n        }\n\n        const backgroundLayer = this.ngeoBackgroundLayerMgr_.get(map) === layer;\n        layersItems.push({\n          backgroundLayer,\n          map,\n          extentByZoom,\n          layerType,\n          layerSerialization,\n          layer,\n          source,\n          ancestors\n        });\n      }\n      return true;\n    };\n    map.getLayers().forEach((root) => {\n      utils.traverseLayer(root, [], visitLayer);\n    });\n    return layersItems;\n  }\n\n  /**\n   * @private\n   * @param {ngeox.OfflinePersistentLayer} offlineLayer The offline layer\n   * @return {function(ol.ImageTile, string)} the tile function\n   */\n  createTileLoadFunction_(offlineLayer) {\n    const that = this;\n    /**\n     * Load the tile from persistent storage.\n     * @param {ol.ImageTile} imageTile The image tile\n     * @param {string} src The tile URL\n     */\n    const tileLoadFunction = function(imageTile, src) {\n      that.getItem(utils.normalizeURL(src)).then((content) => {\n        if (!content) {\n          // use a transparent 1x1 image to make the map consistent\n          content = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=';\n        }\n        imageTile.getImage().src = content;\n      });\n    };\n    return tileLoadFunction;\n  }\n\n  /**\n   * @param {ngeox.OfflinePersistentLayer} offlineLayer The layer to recreate\n   * @return {ol.layer.Layer} the layer.\n   */\n  recreateOfflineLayer(offlineLayer) {\n    if (offlineLayer.layerType === 'tile') {\n      const serialization = offlineLayer.layerSerialization;\n      const tileLoadFunction = this.createTileLoadFunction_(offlineLayer);\n      const layer = this.serDes_.deserializeTileLayer(serialization, tileLoadFunction);\n      return layer;\n    }\n    return null;\n  }\n\n  /**\n   * @return {number} The number\n   */\n  getMaxNumberOfParallelDownloads() {\n    return 11;\n  }\n};\n\n\nexport default exports;\n","/**\n * @module app.offline\n */\nconst exports = {};\n\nimport './offline.less';\nimport './common_dependencies.js';\nimport olMap from 'ol/Map.js';\n\nimport olView from 'ol/View.js';\nimport olLayerTile from 'ol/layer/Tile.js';\nimport olSourceOSM from 'ol/source/OSM.js';\nimport ngeoMapModule from 'ngeo/map/module.js';\nimport ngeoOfflineModule from 'ngeo/offline/module.js';\nimport ngeoOfflineConfiguration from 'ngeo/offline/Configuration.js';\nimport NgeoOfflineServiceManager from 'ngeo/offline/ServiceManager.js';\n\n\n// Useful to work on example - remove me later\nimport 'bootstrap/js/modal.js';\nimport 'jquery-ui/ui/widgets/resizable.js';\nimport 'jquery-ui/ui/widgets/draggable.js';\n\n/** @type {!angular.Module} **/\nexports.module = angular.module('app', [\n  'gettext',\n  ngeoMapModule.name,\n  ngeoOfflineModule.name,\n  NgeoOfflineServiceManager.module.name,\n]);\n\nexports.module.value('ngeoOfflineTestUrl', '../../src/offline/component.html');\n\n// Define the offline download configuration service\nngeoOfflineModule.service('ngeoOfflineConfiguration', ngeoOfflineConfiguration);\n\nclass MainController {\n\n  /**\n   * @param {ngeoFeatureOverlayMgr} ngeoFeatureOverlayMgr ngeo feature overlay manager service.\n   * @param {ngeoNetworkStatus} ngeoNetworkStatus ngeo network status service.\n   * @param {NgeoOfflineServiceManager} ngeoOfflineServiceManager ngeo offline service.\n   * @ngInject\n   */\n  constructor(ngeoFeatureOverlayMgr, ngeoNetworkStatus, ngeoOfflineServiceManager) {\n\n    /**\n     * Save a square of 10 km sideways (Map's unit is the meter).\n     * @type {number}\n     * @export\n     */\n    this.offlineExtentSize = 10000;\n\n    /**\n     * @type {ngeoNetworkStatus}\n     * @export\n     */\n    this.ngeoNetworkStatus = ngeoNetworkStatus;\n\n    /**\n     * @type {ol.Map}\n     * @export\n     */\n    this.map = new olMap({\n      layers: [\n        new olLayerTile({\n          source: new olSourceOSM()\n        })\n      ],\n      view: new olView({\n        center: [352379, 5172733],\n        zoom: 4\n      })\n    });\n\n    ngeoFeatureOverlayMgr.init(this.map);\n\n    ngeoOfflineServiceManager.setSaveService('offlineDownloader');\n    ngeoOfflineServiceManager.setRestoreService('ngeoOfflineRestorer');\n  }\n}\n\n\nexports.module.controller('MainController', MainController);\n\n\nexport default exports;\n","module.exports = \"<div class=main-button> <span ng-if=!$ctrl.hasData()> <div class=no-data ng-click=$ctrl.toggleViewExtentSelection()></div> </span> <span ng-if=$ctrl.hasData()> <div class=with-data ng-click=$ctrl.showMenu()></div> </span> </div> <div ng-if=\\\"$ctrl.selectingExtent && !$ctrl.networkStatus.isDisconnected()\\\" class=\\\"validate-extent btn btn-primary\\\"> <div ng-if=!$ctrl.downloading ng-click=$ctrl.computeSizeAndDisplayAlertLoadData() translate>Save map</div> <div ng-if=$ctrl.downloading ng-click=$ctrl.askAbortDownload() translate>Abort</div> </div> <div ng-if=$ctrl.downloading class=in-progress> <div>{{$ctrl.progressPercents}}%</div> </div> <ngeo-modal ng-model=$ctrl.menuDisplayed> <div class=modal-header> <button type=button class=close data-dismiss=modal aria-label=\\\"{{'Close' | translate}}\\\"> <span aria-hidden=true>&times;</span> </button> <h4 class=modal-title translate>Offline map</h4> </div> <div class=modal-body> <div ng-if=$ctrl.hasData()> <button type=button class=\\\"extent-zoom btn btn-default\\\" ng-if=!$ctrl.offlineMode.isEnabled() ng-click=$ctrl.activateOfflineMode() translate>Activate offline mode </button> <button type=button class=\\\"extent-zoom btn btn-default\\\" ng-if=\\\"$ctrl.offlineMode.isEnabled() && !$ctrl.networkStatus.isDisconnected()\\\" ng-click=$ctrl.deactivateOfflineMode() translate>Deactivate offline mode </button> <button type=button class=\\\"extent-show btn btn-default\\\" ng-if=$ctrl.offlineMode.isEnabled() ng-click=$ctrl.toggleExtentVisibility()> <span ng-if=$ctrl.isExtentVisible() translate>Hide extent</span> <span ng-if=!$ctrl.isExtentVisible() translate>Show extent</span> </button> <button type=button class=\\\"delete btn btn-default\\\" ng-if=!$ctrl.networkStatus.isDisconnected() ng-click=\\\"$ctrl.displayAlertDestroyData = true\\\" translate>Delete data </button> </div> <div ng-if=\\\"!$ctrl.hasData() && !$ctrl.networkStatus.isDisconnected()\\\"> <button type=button class=\\\"new-data btn btn-default\\\" ng-click=$ctrl.toggleViewExtentSelection() translate>Save new map </button> </div> </div> </ngeo-modal> <ngeo-modal ng-model=$ctrl.displayAlertLoadData> <div class=modal-header> <h4 class=modal-title translate>Warning</h4> </div> <div class=modal-body> <p translate>~{{$ctrl.estimatedLoadDataSize}}MB of maps will be downloaded (until scale 1:25'000) - Don't lock your device or navigate away from this site during the download process. Deactivate \\\"private\\\" mode of your browser.</p> <button type=button class=\\\"validate btn btn-primary\\\" data-dismiss=modal ng-click=$ctrl.validateExtent() translate>Ok </button> <button type=button class=\\\"delete btn btn-default\\\" data-dismiss=modal translate>Cancel </button> </div> </ngeo-modal> <ngeo-modal ng-model=$ctrl.displayAlertNoLayer> <div class=modal-header> <h4 class=modal-title translate>Warning</h4> </div> <div class=modal-body> <p translate>No maps selected for saving.</p> <button type=button class=\\\"delete btn btn-default\\\" data-dismiss=modal translate>Ok </button> </div> </ngeo-modal> <ngeo-modal ng-model=$ctrl.displayAlertDestroyData> <div class=modal-header> <h4 class=modal-title translate>Warning</h4> </div> <div class=modal-body> <p translate>Do you really want to remove your data ?</p> <button type=button class=\\\"validate btn btn-primary\\\" data-dismiss=modal ng-click=$ctrl.deleteData() translate>Ok </button> <button type=button class=\\\"delete btn btn-default\\\" data-dismiss=modal translate>Cancel </button> </div> </ngeo-modal> <ngeo-modal ng-model=$ctrl.displayAlertAbortDownload> <div class=modal-header> <h4 class=modal-title translate>Warning</h4> </div> <div class=modal-body> <p translate>Do you really want to remove your data ?</p> <button type=button class=\\\"validate btn btn-primary\\\" data-dismiss=modal ng-click=$ctrl.abortDownload() translate>Ok </button> <button type=button class=\\\"delete btn btn-default\\\" data-dismiss=modal ng-click=$ctrl.followDownloadProgression_() translate>Cancel </button> </div> </ngeo-modal> \";"],"sourceRoot":""}